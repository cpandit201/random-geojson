/*
 * @here/xyz-maps-common
 * (c) 2019 HERE
 */
var t="undefined"!=typeof window?window:global,e=0,n=function(){function t(t,n,i,r,o,s,a,u){this.id=++e,this.exec=i,r&&(this.init=r),this.delay=0^u,this.name=a,this.time=o||100,this.priority=Math.max(Math.min(0^n,5),1),this.manager=t,s&&(this.onDone=s)}return t.prototype.start=function(){return this.manager.start(this)},t.prototype.restart=function(t){this.cancel(),this.canceled=!1,this.paused=!1,this.delayed=null,this.heap=null,t.init&&(this.init=t.init),t.priority&&(this.priority=t.priority),t.onDone&&(this.onDone=t.onDone),this.start()},t.prototype.init=function(){},t.prototype.cancel=function(){return this.manager.cancel(this)},t}();n.prototype.CONTINUE=!0,n.prototype.BREAK=!1,n.prototype.onDone=null,n.prototype.heap=null,n.prototype.paused=!1,n.prototype.delayed=null,n.prototype.yielded=!1,n.prototype.canceled=!1;var i,r=1e3/60,o=0,s=function(){function e(e){this.time=r,this._delayed=null,this.now=Date.now;var n=this;if(n.queue=[[],[],[],[],[],[]],n.id=o++,n.active=!1,e>1&&(n.time=e||r),t.postMessage){var i="tm-"+n.id;t.addEventListener("message",function(e){e.source==t&&e.data==i&&(e.stopPropagation(),n.runner())},!0),n._resume=function(){n.active=!0,t.postMessage(i,"*")}}else n._resume=function(){n.active=!0,setTimeout(n.runner.bind(n),0)}}return e.prototype.runner=function(t){var e,n,i,r,o,s,a,u,h,c=!0;if(t=t||this.now(),this.active){for(;(c=this.now()-t<this.time)&&(this.task=s=this._next());){for(h=!1,a=!1,s.paused?(s.paused=!1,u=s.heap):(i=this.now(),u=s.init());!a;)if(r=i||this.now(),a=!s.exec(u)||s.canceled,n=(o=this.now())-r,i=null,e=o-t>this.time,this.task=null,!a&&(s.paused||n>=s.time)||e){if(a||(this._insert(this.task=s,!0),s.paused=!0,s.heap=u),e)return a&&!s.canceled&&s.onDone&&s.onDone(u),this._resume();h=!0;break}h||(s.paused=!1,s.heap=null,!s.canceled&&s.onDone&&s.onDone(u))}if(!c)return this._resume();this.active=!1}else this._resume()},e.prototype.setExclusiveTime=function(t){this.time=0^t},e.prototype._next=function(){var e,n=this,i=n.queue[0][0],r=n.now();if(i&&r>=i.delayed)return n._delayed&&t.clearTimeout(n._delayed),n.queue[0].shift();for(var o=1;o<5;o++)if(e=n.queue[o].shift())return e;i&&(n._delayed&&t.clearTimeout(n._delayed),n._delayed=t.setTimeout(function(){n._delayed=null,n.active=!0,n.runner()},i.delayed-r))},e.prototype.create=function(t){return new n(this,t.priority,t.exec,t.init,t.time,t.onDone,t.name,t.delay)},e.prototype._insert=function(t,e){var n;if(t.delay){t.delayed=this.now()+t.delay;for(var i=0,r=(n=this.queue[0]).length-1,o=void 0;i<=r;)if(n[o=(i+r)/2|0].delayed>t.delayed)r=o-1;else if(i=o+1,n[o].delayed==t.delayed)break;n.splice(i,0,t)}else n=this.queue[t.priority],e?n.unshift(t):n.push(t)},e.prototype.isWaiting=function(t){return-1!=this.queue[t.delay?0:t.priority].indexOf(t)},e.prototype.start=function(t,e){var n=this.task;t!=n&&(t.canceled=!1,this._insert(t),this.active?n&&n.priority>t.priority&&(n.paused=!0):(this.active=!!e,this.runner()))},e.prototype.cancel=function(t){t.canceled=!0,t.paused=!1;var e=t==this.task,n=t.delay?0:t.priority,i=this.queue[n],r=i.indexOf(t);return-1!=r&&i.splice(r,1),e&&(this.task=null),e},e}(),a={getInstance:function(t){return i?"number"==typeof t&&(i.time=t):i=this.createInstance(t),i},createInstance:function(t){return this.active=!0,new s(t)},active:!1},u=function(t,e,n){for(var i=-1,r=0;r<t.length;r++)if(t[r][0]==e&&t[r][1]==n){i=r;break}return i},h=function(){function t(){this._l={},this._sync=!1,this._exec={};for(var t=arguments[0]instanceof Array?arguments[0]:arguments,e=0;e<t.length;e++)this.addEvent(t[e])}return t.prototype.addEvent=function(t){this._l[t]||(this._l[t]=[],this._exec[t]=void 0)},t.prototype.sync=function(t){return this._sync=!!t,this},t.prototype.removeEvent=function(t){delete this._l[t]},t.prototype.getEvents=function(){var t=[];for(var e in this._l)t[t.length]=e;return t},t.prototype.get=function(t){var e=this._l[t];return e&&e.slice()},t.prototype.isDefined=function(t){return!!this._l[t]},t.prototype.isListened=function(t){return this._l[t]&&this._l[t].length},t.prototype.add=function(t,e,n){var i=!1;return this._l.hasOwnProperty(t)&&-1==u(this._l[t],e,n)&&(this._l[t].push([e,n]),i=!0),i},t.prototype.remove=function(t,e,n){if(this._l.hasOwnProperty(t)){var i=u(this._l[t],e,n);if(-1!=i)return this._exec[t]--,this._l[t].splice(i,1),!0}return!1},t.prototype.trigger=function(t,e,n,i){var r,o=!1;if(this._l[t]){var s=this._l[t].length;for(this._exec[t]=0;this._exec[t]<s;this._exec[t]++)if(o=!0,r=this._l[t][this._exec[t]]){if(i&&!i(r))continue;n||this._sync?r[0].apply(r[1],e):function(t,e,n){setTimeout(function(){t.apply(e,n)},0)}(r[0],r[1],e)}this._exec[t]=void 0}return o},t}(),c=function(){return function(t,e){this.key=t,this.data=e}}();c.prototype.data=null,c.prototype.next=null,c.prototype.prev=null;var p=function(){function t(t){this.length=0,this.head=null,this.tail=null,this.max=t||5e3,this._={},this.tail=null}return t.prototype.setSize=function(t){if(this.length>t)for(var e=this.length-t;e--;)this.remove(this.tail.key);this.max=t},t.prototype.get=function(t){var e,n,i;return(e=this._[t])&&(e!=this.head&&(this.tail==e&&(this.tail=e.next),n=e.prev,i=e.next,n&&(n.next=e.next||e),i&&(i.prev=n),(n=this.head)&&(n.next=e),e.prev=this.head,e.next=null,this.head=e),e=e.data),e},t.prototype.toArray=function(){for(var t=[],e=this.tail,n=0;e;)t[n++]=e.data,e=e.next;return t},t.prototype.forEach=function(t){for(var e=this.tail,n=0;e;)t(e.data,n++),e=e.next},t.prototype.clear=function(){this._={},this.head=null,this.tail=null,this.length=0},t.prototype.remove=function(t){var e,n,i;return(e=this._[t])&&(n=e.prev,i=e.next,n&&(n.next=i),i&&(i.prev=n),i||(this.head=n),n||(this.tail=i),delete this._[t],e=e.data,this.length--),e},t.prototype.set=function(t,e){var n,i,r;return(n=this._[t])?(n.data=e,n!=this.head&&this.get(t)):(this.length==this.max?(r=this.tail.data,delete this._[this.tail.key],this.tail=this.tail.next,this.tail.prev=null):this.length++,n=new c(t,e),this._[t]=n,(i=this.head)?(n.prev=i,i.next=n):this.tail=n,this.head=n),r},t}(),l=a.getInstance(13),f=function(t,e,n){n=n||l;var i=t.indexOf("["),r=t.lastIndexOf("]"),o=function(e,n){e.grp=20,e.elements.push.apply(e.elements,JSON.parse("["+t.slice(e.start,n)+"]")),e.start=null};n.create({name:"PJA",priority:4,time:4,onDone:function(n){if(e){var o=void 0,s=n.elements;if(s.length)if(-1!=t.indexOf('"type":"FeatureCollection"')){var a=JSON.parse(t.substr(0,i+1)+t.substr(r));a.features=s,o=a}else o=s;else o=JSON.parse(t);e(o)}},init:function(){return{i:i,open:0,start:null,len:r,elements:[],grp:20,last:null}},exec:function(e){var n,i,r=e.elements,s=e.len;if(e.i<s){for(;(n=e.i++)<s;)if('"'!=(i=t.charAt(n))){if("{"==i)e.open++,null==e.start&&(e.start=n);else if("}"==i){if(0==--e.open)return--e.grp&&n<s-2?this.CONTINUE:(e.grp=20,r.push.apply(r,JSON.parse("["+t.slice(e.start,e.last=n+1)+"]")),e.start=null,this.CONTINUE)}else if(0==e.open&&!isNaN(i)){20!=e.grp&&o(e,n-1);var a=t.substr(n),u=a.search("[0-9](]|,)")+1;r.push(parseFloat(a.substring(0,u))),e.i=n+u}}else e.i=t.indexOf('"',n+1)+1;20!=e.grp&&null!=e.last&&r.push.apply(r,JSON.parse("["+t.slice(e.last+1,t.lastIndexOf("]"))+"]"))}}}).start()},y=function(t,e,n){if(null==n||"object"!=typeof n)return n;if(n.constructor!=Object&&n.constructor!=Array)return n;if(n.constructor==Date||n.constructor==RegExp||n.constructor==Function||n.constructor==String||n.constructor==Number||n.constructor==Boolean)return new n.constructor(n);for(var i in e=e||new n.constructor,n)e[i]=y(t,t?e[i]:null,n[i]);return e},d=function(t,e){for(var n in e)"constructor"!=n&&(t[n]=e[n]);return t},v=function(t){var e,n;if("object"!=typeof t)return t;if(!t)return t;if("[object Array]"===Object.prototype.toString.apply(t)){for(e=[],n=0;n<t.length;n+=1)e[n]=v(t[n]);return e}for(n in e={},t)t.hasOwnProperty(n)&&(e[n]=v(t[n]));return e},_={loglevel:"debug",dump:function(t,e){var n=!!_.loglevel,i=Array.prototype.slice.call(arguments),r=i[i.length-1],o=window.console;n&&o&&(r in o?i.pop():r="log",(!0===n||n===r)&&(Function.prototype.bind&&"object"==typeof o.log?Function.prototype.bind.call(o[r],o).apply(o,i):o[r].apply(o,i)));return _},extend:function(t,e,n){return"boolean"!=typeof t&&(n=e,e=t,t=!1),y(t,e,n)},clone:v,createObject:Object.create||function(t){var e=function(){};return e.prototype=t,new e},inheritClass:function(t,e,n){var i=e.prototype,r=t.prototype;for(var o in"object"==typeof e&&(n=e,e.constructor==Object.prototype.constructor&&(e.constructor=function(){t.apply(this,arguments)}),e=e.constructor),e.prototype=_.createObject(r),i&&i!=Object.prototype&&d(e.prototype,i),t)e[o]=t[o];return n&&d(e.prototype,n),e},isFunction:function(t){return"function"==typeof t},isNumeric:function(t){return!isNaN(+t)&&isFinite(t)},isPlainObject:function(t){if(!t||"object"!=typeof t||t.nodeType||t==t.window)return!1;try{if(t.constructor&&!t.hasOwnProperty("constructor")&&!t.constructor.prototype.hasOwnProperty("isPrototypeOf"))return!1}catch(t){return!1}var e;for(e in t);return void 0===e||t.hasOwnProperty(e)},String:{round:function(t,e){return e?Number(t.toFixed(e)):Math.round(t)},random:function(t){t=t||16;for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz",i=n.length,r=0;r<t;r++)e+=n.charAt(Math.random()*i^0);return e}}},g=Math.PI/180,M=180/Math.PI,m=Object.freeze({calcBearing:function(t,e){var n,i,r,o,s;return n=Math.PI/180,i=t[1]*n,r=e[1]*n,o=t[0]*n,s=e[0]*n,(Math.atan2(Math.cos(i)*Math.sin(r)-Math.sin(i)*Math.cos(r)*Math.cos(s-o),Math.sin(s-o)*Math.cos(r))/n+360)%360},movePoint:function(t,e,n,i){var r=e/(i=void 0===i?6371e3:i),o=n*g,s=t[1]*g,a=t[0]*g,u=Math.asin(Math.sin(s)*Math.cos(r)+Math.cos(s)*Math.sin(r)*Math.cos(o)),h=a+Math.atan2(Math.sin(o)*Math.sin(r)*Math.cos(s),Math.cos(r)-Math.sin(s)*Math.sin(u));return[(h=(h+3*Math.PI)%(2*Math.PI)-Math.PI)*M,u*M]},getPointBBox:function(t,e){var n=t[1],i=t[0],r=Math.asin(e/(6371e3*Math.cos(Math.PI*n/180)))*M,o=Math.asin(e/6371e3)*M;return[i-r,n-o,i+r,n+o]},mergeBBoxes:function(t,e){return t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[2]&&(t[2]=e[2]),t[3]<e[3]&&(t[3]=e[3]),t},extendBBox:function(t,e){var n=Math.abs(Math.asin(e/(6371e3*Math.cos(t[0]*g))))*M,i=Math.abs(Math.asin(e/(6371e3*Math.cos(t[2]*g))))*M,r=Math.abs(Math.asin(e/6371e3))*M;return[t[0]-n,t[1]-r,t[2]+i,t[3]+r]},distance:function(t,e){var n=g*(e[1]-t[1]),i=g*(e[0]-t[0]),r=Math.sin(n/2)*Math.sin(n/2)+Math.cos(g*t[1])*Math.cos(g*e[1])*Math.sin(i/2)*Math.sin(i/2);return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))*6371e3}}),x=function(){function t(t){if(this.size=0,this._=[],t)for(var e=0;e<t.length;e++)this.add(t[e])}return t.prototype.add=function(t){var e=!this.has(t);return e&&(this.size=this._.push(t)),e},t.prototype.clear=function(){this.size=this._.length=0},t.prototype.delete=function(t){var e=this._.indexOf(t),n=-1!=e;return n&&(this._.splice(e,1),this.size--),n},t.prototype.has=function(t){return-1!=this._.indexOf(t)},t.prototype.toArray=function(){return this._.slice(0)},t}(),b=function(){function t(t){if(this._={},this.size=0,t)for(var e=0;e<t.length;e++)this.set(t[e][0],t[e][1])}return t.prototype.clear=function(){this.size=0,this._={}},t.prototype.delete=function(t){var e=this.has(t);return e&&(delete this._[t],this.size--),e},t.prototype.get=function(t){return this._[t]},t.prototype.has=function(t){return null!=this._[t]},t.prototype.set=function(t,e){var n=!this.has(t);return n&&(this.size++,this._[t]=e),n},t.prototype.values=function(){var t=this._,e=[];for(var n in t)e[e.length]=t[n];return e},t.prototype.keys=function(){var t=this._,e=[];for(var n in t)e[e.length]=n;return e},t.prototype.forEach=function(t){var e=this._;for(var n in e)t(e[n],n,this)},t}(),O=function(){function t(){this.queue=[]}return t.prototype.add=function(t){if("function"==typeof t)return this.queue.push(t)},t.prototype.done=function(){for(var t=this.queue;t.length;)t.shift().apply(void 0,arguments)},t}(),w=t;"here.xyz.maps".split(".").forEach(function(t){return w=w[t]=w[t]||{}}),t.HERE=t.here;var N={LRU:p,TaskManager:a,Listener:h,parseJSONArray:f,JSUtils:_,geotools:m,global:t,Queue:O,Set:x,Map:b};w.common=N;export default N;export{_ as JSUtils,p as LRU,h as Listener,b as Map,O as Queue,x as Set,a as TaskManager,m as geotools,t as global,f as parseJSONArray};
