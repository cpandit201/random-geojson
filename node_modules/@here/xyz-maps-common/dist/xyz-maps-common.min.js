/*
 * @here/xyz-maps-common
 * (c) 2019 HERE
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(((t=t||self).here=t.here||{},t.here.xyz=t.here.xyz||{},t.here.xyz.maps=t.here.xyz.maps||{},t.here.xyz.maps.common={}))}(this,function(t){"use strict";var o="undefined"!=typeof window?window:global,u=0,e=function(){function t(t,e,n,r,i,o,s,a){this.id=++u,this.exec=n,r&&(this.init=r),this.delay=0^a,this.name=s,this.time=i||100,this.priority=Math.max(Math.min(0^e,5),1),this.manager=t,o&&(this.onDone=o)}return t.prototype.start=function(){return this.manager.start(this)},t.prototype.restart=function(t){this.cancel(),this.canceled=!1,this.paused=!1,this.delayed=null,this.heap=null,t.init&&(this.init=t.init),t.priority&&(this.priority=t.priority),t.onDone&&(this.onDone=t.onDone),this.start()},t.prototype.init=function(){},t.prototype.cancel=function(){return this.manager.cancel(this)},t}();e.prototype.CONTINUE=!0,e.prototype.BREAK=!1,e.prototype.onDone=null,e.prototype.heap=null,e.prototype.paused=!1,e.prototype.delayed=null,e.prototype.yielded=!1,e.prototype.canceled=!1;var n,a,r=1e3/60,i=0,s=function(){function t(t){this.time=r,this._delayed=null,this.now=Date.now;var e=this;if(e.queue=[[],[],[],[],[],[]],e.id=i++,e.active=!1,1<t&&(e.time=t||r),o.postMessage){var n="tm-"+e.id;o.addEventListener("message",function(t){t.source==o&&t.data==n&&(t.stopPropagation(),e.runner())},!0),e._resume=function(){e.active=!0,o.postMessage(n,"*")}}else e._resume=function(){e.active=!0,setTimeout(e.runner.bind(e),0)}}return t.prototype.runner=function(t){var e,n,r,i,o,s,a,u,h,c=this,p=!0;if(t=t||c.now(),c.active){for(;(p=c.now()-t<c.time)&&(c.task=s=c._next());){for(a=h=!1,u=s.paused?(s.paused=!1,s.heap):(r=c.now(),s.init());!a;)if(i=r||c.now(),a=!s.exec(u)||s.canceled,n=(o=c.now())-i,r=null,e=o-t>c.time,c.task=null,!a&&(s.paused||n>=s.time)||e){if(a||(c._insert(c.task=s,!0),s.paused=!0,s.heap=u),e)return a&&!s.canceled&&s.onDone&&s.onDone(u),c._resume();h=!0;break}h||(s.paused=!1,s.heap=null,!s.canceled&&s.onDone&&s.onDone(u))}if(!p)return c._resume();c.active=!1}else c._resume()},t.prototype.setExclusiveTime=function(t){this.time=0^t},t.prototype._next=function(){var t,e=this,n=e.queue[0][0],r=e.now();if(n&&r>=n.delayed)return e._delayed&&o.clearTimeout(e._delayed),e.queue[0].shift();for(var i=1;i<5;i++)if(t=e.queue[i].shift())return t;n&&(e._delayed&&o.clearTimeout(e._delayed),e._delayed=o.setTimeout(function(){e._delayed=null,e.active=!0,e.runner()},n.delayed-r))},t.prototype.create=function(t){return new e(this,t.priority,t.exec,t.init,t.time,t.onDone,t.name,t.delay)},t.prototype._insert=function(t,e){var n;if(t.delay){t.delayed=this.now()+t.delay;for(var r=0,i=(n=this.queue[0]).length-1,o=void 0;r<=i;)if(n[o=(r+i)/2|0].delayed>t.delayed)i=o-1;else if(r=o+1,n[o].delayed==t.delayed)break;n.splice(r,0,t)}else n=this.queue[t.priority],e?n.unshift(t):n.push(t)},t.prototype.isWaiting=function(t){return-1!=this.queue[t.delay?0:t.priority].indexOf(t)},t.prototype.start=function(t,e){var n=this.task;t!=n&&(t.canceled=!1,this._insert(t),this.active?n&&n.priority>t.priority&&(n.paused=!0):(this.active=!!e,this.runner()))},t.prototype.cancel=function(t){t.canceled=!0,t.paused=!1;var e=t==this.task,n=t.delay?0:t.priority,r=this.queue[n],i=r.indexOf(t);return-1!=i&&r.splice(i,1),e&&(this.task=null),e},t}(),h={getInstance:function(t){return n?"number"==typeof t&&(n.time=t):n=this.createInstance(t),n},createInstance:function(t){return this.active=!0,new s(t)},active:!1},c=function(t,e,n){for(var r=-1,i=0;i<t.length;i++)if(t[i][0]==e&&t[i][1]==n){r=i;break}return r},p=function(){function t(){this._l={},this._sync=!1,this._exec={};for(var t=arguments[0]instanceof Array?arguments[0]:arguments,e=0;e<t.length;e++)this.addEvent(t[e])}return t.prototype.addEvent=function(t){this._l[t]||(this._l[t]=[],this._exec[t]=a)},t.prototype.sync=function(t){return this._sync=!!t,this},t.prototype.removeEvent=function(t){delete this._l[t]},t.prototype.getEvents=function(){var t=[];for(var e in this._l)t[t.length]=e;return t},t.prototype.get=function(t){var e=this._l[t];return e&&e.slice()},t.prototype.isDefined=function(t){return!!this._l[t]},t.prototype.isListened=function(t){return this._l[t]&&this._l[t].length},t.prototype.add=function(t,e,n){var r=!1;return this._l.hasOwnProperty(t)&&-1==c(this._l[t],e,n)&&(this._l[t].push([e,n]),r=!0),r},t.prototype.remove=function(t,e,n){if(this._l.hasOwnProperty(t)){var r=c(this._l[t],e,n);if(-1!=r)return this._exec[t]--,this._l[t].splice(r,1),!0}return!1},t.prototype.trigger=function(t,e,n,r){var i,o=!1;if(this._l[t]){var s=this._l[t].length;for(this._exec[t]=0;this._exec[t]<s;this._exec[t]++)if(o=!0,i=this._l[t][this._exec[t]]){if(r&&!r(i))continue;n||this._sync?i[0].apply(i[1],e):function(t,e,n){setTimeout(function(){t.apply(e,n)},0)}(i[0],i[1],e)}this._exec[t]=a}return o},t}(),l=function(t,e){this.key=t,this.data=e};l.prototype.data=null,l.prototype.next=null,l.prototype.prev=null;var f=function(){function t(t){this.length=0,this.head=null,this.tail=null,this.max=t||5e3,this._={},this.tail=null}return t.prototype.setSize=function(t){if(this.length>t)for(var e=this.length-t;e--;)this.remove(this.tail.key);this.max=t},t.prototype.get=function(t){var e,n,r;return(e=this._[t])&&(e!=this.head&&(this.tail==e&&(this.tail=e.next),n=e.prev,r=e.next,n&&(n.next=e.next||e),r&&(r.prev=n),(n=this.head)&&(n.next=e),e.prev=this.head,e.next=null,this.head=e),e=e.data),e},t.prototype.toArray=function(){for(var t=[],e=this.tail,n=0;e;)t[n++]=e.data,e=e.next;return t},t.prototype.forEach=function(t){for(var e=this.tail,n=0;e;)t(e.data,n++),e=e.next},t.prototype.clear=function(){this._={},this.head=null,this.tail=null,this.length=0},t.prototype.remove=function(t){var e,n,r;return(e=this._[t])&&(n=e.prev,r=e.next,n&&(n.next=r),r&&(r.prev=n),r||(this.head=n),n||(this.tail=r),delete this._[t],e=e.data,this.length--),e},t.prototype.set=function(t,e){var n,r,i;return(n=this._[t])?(n.data=e,n!=this.head&&this.get(t)):(this.length==this.max?(i=this.tail.data,delete this._[this.tail.key],this.tail=this.tail.next,this.tail.prev=null):this.length++,n=new l(t,e),this._[t]=n,(r=this.head)?(n.prev=r).next=n:this.tail=n,this.head=n),i},t}(),y=h.getInstance(13),d=function(h,i,t){t=t||y;var o=h.indexOf("["),s=h.lastIndexOf("]");t.create({name:"PJA",priority:4,time:4,onDone:function(t){if(i){var e=void 0,n=t.elements;if(n.length)if(-1!=h.indexOf('"type":"FeatureCollection"')){var r=JSON.parse(h.substr(0,o+1)+h.substr(s));r.features=n,e=r}else e=n;else e=JSON.parse(h);i(e)}},init:function(){return{i:o,open:0,start:null,len:s,elements:[],grp:20,last:null}},exec:function(t){var e,n,r,i,o=t.elements,s=t.len;if(t.i<s){for(;(e=t.i++)<s;)if('"'!=(n=h.charAt(e))){if("{"==n)t.open++,null==t.start&&(t.start=e);else if("}"==n){if(0==--t.open)return--t.grp&&e<s-2||(t.grp=20,o.push.apply(o,JSON.parse("["+h.slice(t.start,t.last=e+1)+"]")),t.start=null),this.CONTINUE}else if(0==t.open&&!isNaN(n)){20!=t.grp&&(i=e-1,(r=t).grp=20,r.elements.push.apply(r.elements,JSON.parse("["+h.slice(r.start,i)+"]")),r.start=null);var a=h.substr(e),u=a.search("[0-9](]|,)")+1;o.push(parseFloat(a.substring(0,u))),t.i=e+u}}else t.i=h.indexOf('"',e+1)+1;20!=t.grp&&null!=t.last&&o.push.apply(o,JSON.parse("["+h.slice(t.last+1,h.lastIndexOf("]"))+"]"))}}}).start()},v=function(t,e,n){if(null==n||"object"!=typeof n)return n;if(n.constructor!=Object&&n.constructor!=Array)return n;if(n.constructor==Date||n.constructor==RegExp||n.constructor==Function||n.constructor==String||n.constructor==Number||n.constructor==Boolean)return new n.constructor(n);for(var r in e=e||new n.constructor,n)e[r]=v(t,t?e[r]:null,n[r]);return e},_=function(t,e){for(var n in e)"constructor"!=n&&(t[n]=e[n]);return t},g=function(t){var e,n;if("object"!=typeof t)return t;if(!t)return t;if("[object Array]"===Object.prototype.toString.apply(t)){for(e=[],n=0;n<t.length;n+=1)e[n]=g(t[n]);return e}for(n in e={},t)t.hasOwnProperty(n)&&(e[n]=g(t[n]));return e},m={loglevel:"debug",dump:function(t,e){var n=!!m.loglevel,r=Array.prototype.slice.call(arguments),i=r[r.length-1],o=window.console;n&&o&&(i in o?r.pop():i="log",(!0===n||n===i)&&(Function.prototype.bind&&"object"==typeof o.log?Function.prototype.bind.call(o[i],o).apply(o,r):o[i].apply(o,r)));return m},extend:function(t,e,n){return"boolean"!=typeof t&&(n=e,e=t,t=!1),v(t,e,n)},clone:g,createObject:Object.create||function(t){var e=function(){};return e.prototype=t,new e},inheritClass:function(t,e,n){var r=e.prototype,i=t.prototype;for(var o in"object"==typeof e&&((n=e).constructor==Object.prototype.constructor&&(e.constructor=function(){t.apply(this,arguments)}),e=e.constructor),e.prototype=m.createObject(i),r&&r!=Object.prototype&&_(e.prototype,r),t)e[o]=t[o];return n&&_(e.prototype,n),e},isFunction:function(t){return"function"==typeof t},isNumeric:function(t){return!isNaN(+t)&&isFinite(t)},isPlainObject:function(t){if(!t||"object"!=typeof t||t.nodeType||t==t.window)return!1;try{if(t.constructor&&!t.hasOwnProperty("constructor")&&!t.constructor.prototype.hasOwnProperty("isPrototypeOf"))return!1}catch(t){return!1}var e;for(e in t);return void 0===e||t.hasOwnProperty(e)},String:{round:function(t,e){return e?Number(t.toFixed(e)):Math.round(t)},random:function(t){t=t||16;for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz",r=n.length,i=0;i<t;i++)e+=n.charAt(Math.random()*r^0);return e}}},M=Math.PI/180,x=180/Math.PI,b=6371e3,O=Object.freeze({calcBearing:function(t,e){var n,r,i,o,s;return n=Math.PI/180,r=t[1]*n,i=e[1]*n,o=t[0]*n,s=e[0]*n,(Math.atan2(Math.cos(r)*Math.sin(i)-Math.sin(r)*Math.cos(i)*Math.cos(s-o),Math.sin(s-o)*Math.cos(i))/n+360)%360},movePoint:function(t,e,n,r){var i=e/(r=void 0===r?b:r),o=n*M,s=t[1]*M,a=t[0]*M,u=Math.asin(Math.sin(s)*Math.cos(i)+Math.cos(s)*Math.sin(i)*Math.cos(o)),h=a+Math.atan2(Math.sin(o)*Math.sin(i)*Math.cos(s),Math.cos(i)-Math.sin(s)*Math.sin(u));return[(h=(h+3*Math.PI)%(2*Math.PI)-Math.PI)*x,u*x]},getPointBBox:function(t,e){var n=t[1],r=t[0],i=Math.asin(e/(b*Math.cos(Math.PI*n/180)))*x,o=Math.asin(e/b)*x;return[r-i,n-o,r+i,n+o]},mergeBBoxes:function(t,e){return t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[2]&&(t[2]=e[2]),t[3]<e[3]&&(t[3]=e[3]),t},extendBBox:function(t,e){var n=Math.abs(Math.asin(e/(b*Math.cos(t[0]*M))))*x,r=Math.abs(Math.asin(e/(b*Math.cos(t[2]*M))))*x,i=Math.abs(Math.asin(e/b))*x;return[t[0]-n,t[1]-i,t[2]+r,t[3]+i]},distance:function(t,e){var n=M*(e[1]-t[1]),r=M*(e[0]-t[0]),i=Math.sin(n/2)*Math.sin(n/2)+Math.cos(M*t[1])*Math.cos(M*e[1])*Math.sin(r/2)*Math.sin(r/2),o=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i));return b*o}}),w=function(){function t(t){if(this.size=0,this._=[],t)for(var e=0;e<t.length;e++)this.add(t[e])}return t.prototype.add=function(t){var e=!this.has(t);return e&&(this.size=this._.push(t)),e},t.prototype.clear=function(){this.size=this._.length=0},t.prototype.delete=function(t){var e=this._.indexOf(t),n=-1!=e;return n&&(this._.splice(e,1),this.size--),n},t.prototype.has=function(t){return-1!=this._.indexOf(t)},t.prototype.toArray=function(){return this._.slice(0)},t}(),P=function(){function t(t){if(this._={},this.size=0,t)for(var e=0;e<t.length;e++)this.set(t[e][0],t[e][1])}return t.prototype.clear=function(){this.size=0,this._={}},t.prototype.delete=function(t){var e=this.has(t);return e&&(delete this._[t],this.size--),e},t.prototype.get=function(t){return this._[t]},t.prototype.has=function(t){return null!=this._[t]},t.prototype.set=function(t,e){var n=!this.has(t);return n&&(this.size++,this._[t]=e),n},t.prototype.values=function(){var t=this._,e=[];for(var n in t)e[e.length]=t[n];return e},t.prototype.keys=function(){var t=this._,e=[];for(var n in t)e[e.length]=n;return e},t.prototype.forEach=function(t){var e=this._;for(var n in e)t(e[n],n,this)},t}(),N=function(){function t(){this.queue=[]}return t.prototype.add=function(t){if("function"==typeof t)return this.queue.push(t)},t.prototype.done=function(){for(var t=this.queue;t.length;)t.shift().apply(void 0,arguments)},t}(),j=o;"here.xyz.maps".split(".").forEach(function(t){return j=j[t]=j[t]||{}}),o.HERE=o.here;var z={LRU:f,TaskManager:h,Listener:p,parseJSONArray:d,JSUtils:m,geotools:O,global:o,Queue:N,Set:w,Map:P};j.common=z,t.JSUtils=m,t.LRU=f,t.Listener=p,t.Map=P,t.Queue=N,t.Set=w,t.TaskManager=h,t.default=z,t.geotools=O,t.global=o,t.parseJSONArray=d,Object.defineProperty(t,"__esModule",{value:!0})});
