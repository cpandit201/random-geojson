/*
 * @here/xyz-maps-display
 * (c) 2019 HERE
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@here/xyz-maps-common"),require("@here/xyz-maps-core")):"function"==typeof define&&define.amd?define(["exports","@here/xyz-maps-common","@here/xyz-maps-core"],e):e(((t=t||self).here=t.here||{},t.here.xyz=t.here.xyz||{},t.here.xyz.maps=t.here.xyz.maps||{},t.here.xyz.maps.Map=t.here.xyz.maps.Map||{}),t.here.xyz.maps.common,t.here.xyz.maps)}(this,function(t,et,e){"use strict";var _=function(e,t,n,r){("string"==typeof t?[t]:t).forEach(function(t){e.addEventListener(t,n,r)})},Z=function(e,t,n){("string"==typeof t?[t]:t).forEach(function(t){e.removeEventListener(t,n)})},nt=function(t,e){return 0^parseInt((r=e,(o=(n=t).ownerDocument.defaultView.getComputedStyle(n,null))&&""===(i=o.getPropertyValue(r))&&(i=n.style[r]),i));var n,r,i,o},r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function u(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var N,n=document.createElement("canvas").getContext("2d"),i="abcdefghijklmnopqrstuvwxyz",o=(i=i+i.toUpperCase()+"0123456789").length,a={},s={},w="normal 12px Arial",L=function(t){return a[t]||(n.font=t,a[t]=n.measureText(i).width/o),a[t]},M=function(t){return s[t]=s[t]||new Function("f","return f."+t)},b=1/0,I=function(t,e,n,r){var i=e[t];return"function"==typeof i?i(n,r):i},U=function(t,e,n){for(var r,i,o,a=0,s=0,l=0;l<t.length;l++)o=t[l],s<(i=I("zIndex",o,e,n))&&(s=i),a<(r=I("strokeWidth",o,e,n)||1)&&(a=r);return[a,s]},V=function(t,e,n){for(var r,i,o,a,s,l,u,c,h,p,f,d=0,y=b,v=-b,g=b,m=-b,x=0;x<t.length;x++)if(d<(p=I("zIndex",t[x],e,n))&&(d=p),i=t[x],"Image"==(o=I("type",i,e,n))||I("fill",i,e,n)){if("Text"==o){if((f=i.text)==N&&(f=M(i.textRef)(e)),null==f)continue;a=L(i.font||w)*f.length,s=14}else r=I("strokeWidth",i,e,n)||1,s="Circle"==o?a=2*I("radius",i,e,n)^0:(a=0^I("width",i,e,n),(s=I("height",i,e,n))==N?a:0^s),s+=r,a+=r;(l=(0^I("offsetX",i,e,n))-.5*a)<y&&(y=l),v<(u=l+a)&&(v=u),(c=(0^I("offsetY",i,e,n))-.5*s)<g&&(g=c),m<(h=c+s)&&(m=h)}if(v!=-b)return[y,g,v,m,d]},F=function(t,e,n){for(var r,i=0,o=0;o<t.length;o++)i<(r=I("zIndex",t[o],e,n))&&(i=r);return i};function l(){var t=this._s;for(var e in this.ready=!0,t)t[e][0](this,t[e][1])}var x,T=new(function(){function t(){this.src={}}return t.prototype.isRequested=function(t){return!!this.src[t]},t.prototype.isReady=function(t){return this.src[t]&&this.src[t].ready},t.prototype.get=function(t,e,n,r,i){var o=this.src;if(null==o[t]){var a=o[t]=new Image;a.ready=!1,a._s={},e&&(a._s[n]=[e,r]),a.crossOrigin="Anonymous",a.onload=l,a.src=t}else e&&(o[t].ready?e(o[t],r):o[t]._s[n]=[e,r]);return o[t]},t}()),z=2*Math.PI,S=Math.PI/180,C=Math.log(2048)/Math.log(2),k=C+9,D=function(t,e,n,r,i,o,a,s,l,u,c,h){var p=a.z;e+=0^I("offsetX",r,i,p),n+=0^I("offsetY",r,i,p);var f,d,y,v,g,m,x=I("rotation",r,i,p),w=e+512<<C|n+512^0|(x+360)%360<<k;c[w]||(c[w]=1,x&&(x*=S,l.translate(e,n),l.rotate(x),g=e,m=n,n=e=0),"Text"==t?(r.stroke&&0!=r.strokeWidth&&l.strokeText(o,e,n),r.fill&&l.fillText(o,e,n)):"Circle"==t?(d=I("radius",r,i,p),l.moveTo(e+d,n),l.arc(e,n,d,0,z,!1)):(e-=(y=I("width",r,i,p))/2,n-=(v=I("height",r,i,p)||y)/2,"Image"==t?(f=I("src",r,i,p),T.isReady(f)?l.drawImage(T.get(f),e,n,y,v):T.get(f,function(){return h.updateTile(a,s,u)},a.quadkey)):"Rect"==t&&l.rect(e,n,y,v)),x&&(l.rotate(-x),l.translate(-g,-m)))},j=Math,c=function(){function t(){this.o=.5}return t.prototype.init=function(t){return this.o=t,!0},t.prototype.createSymbol=function(t,e){return 0<t-("Circle"==e.type?e.radius:e.width)},t.prototype.drawSymbol=function(t,e,n,r,i,o,a,s,l,u,c){D(i.type,e,n,i,a,!1,o,s,r,l,u,c)},t.prototype.angle=function(t,e){return Math.atan2(t,e)},t.prototype.place=function(t,e,n,r,i,o,a,s,l,u){var c,h,p,f,d,y,v,g,m,x,w=this.o;c=e.lon2x(t[0][0]),h=e.lat2y(t[0][1]);for(var L=1;L<t.length;L++)m=(p=e.lon2x(t[L][0]))-c,x=(f=e.lat2y(t[L][1]))-h,d=j.sqrt(j.pow(m,2)+j.pow(x,2))-16,(y=this.createSymbol(d,i))&&(v=(m*w+c)*u,g=(x*w+h)*u,n.setTransform(u,0,0,u,v,g),n.rotate(this.angle(x,m)),n.translate(-v,-g),this.drawSymbol(y,v,g,n,i,e,r,o,a,s,l),n.setTransform(u,0,0,u,0,0)),c=p,h=f},t}(),h=function(n){function t(t){var e=n.call(this)||this;return n.prototype.init.call(e,.5),e.setCharWidth(t),e}return u(t,n),t.prototype.setCharWidth=function(t){this.cw=t},t.prototype.init=function(t){return"string"!=typeof t&&(t=String(t)),this.lw=t.length*this.cw,this.label=t,!0},t.prototype.angle=function(t,e){return Math.atan(t/e)},t.prototype.createSymbol=function(t){var e,n,r=this.label,i=this.cw,o=this.lw,a=Math.floor(t/o);return 0<a&&(e=r,1<a&&(a=1+Math.floor((a-1)/8),n=new Array(Math.floor(1.5*(t-o)/i/a)).join(" "),e=r+new Array(a).join(n+r))),e},t.prototype.drawSymbol=function(t,e,n,r,i){i.stroke&&r.strokeText(t,e,n),i.fill&&r.fillText(t,e,n)},t}(c),E=function(t,e,n){var r,i,o,a,s=t.length-1;for(e.moveTo(o=n.lon2x(t[s][0]),a=n.lat2y(t[s][1]));s--;)r=n.lon2x(t[s][0]),i=n.lat2y(t[s][1]),(o-r||a-i)&&e.lineTo(o=r,a=i)},p="round",f=[],P=new h(L(w)),A=new c;var g,m={init:function(t,e,n){t.globalAlpha=e.opacity==x?1:e.opacity;var r,i,o=e.font,a=e.stroke;if(a&&(t.strokeStyle=a,o&&(n=1),(r=e.strokeWidth)&&"number"==typeof r||(r=1),t.lineWidth=r*n),e.fill&&(t.fillStyle=e.fill),o){var s=e.font||w;P.setCharWidth(L(s)),t.font=s,t.textAlign=e.textAlign||"center",t.textBaseline=e.textBaseline||"middle"}else t.lineCap=e.strokeLinecap||p,t.lineJoin=e.strokeLinejoin||p,(i=e.strokeDasharray)instanceof Array?t.setLineDash(i):t.setLineDash(f),(e.fill||e.stroke)&&t.beginPath();return!0},feature:function(t,e,n,r,i,o,a,s,l,u){var c=n.geometry.coordinates,h=n.geometry.type,p=t.z,f=I("type",i,n,p);if("LineString"==h){if("Circle"==f||"Rect"==f||"Image"==f){var d=I("offset",i,n,p);if(d!=x)return A.init(d),void A.place(c,t,e,n,i,o,a,s,l,u);h="MultiPoint"}}else if(("Polygon"==h||"MultiPolygon"==h)&&"Polygon"!=f&&"Line"!=f){var y=n.bbox;return D(f,t.lon2x(y[0]+(y[2]-y[0])/2),t.lat2y(y[1]+(y[3]-y[1])/2),i,n,r,t,o,e,a,s,l)}if("Point"==h)D(f,t.lon2x(c[0]),t.lat2y(c[1]),i,n,r,t,o,e,a,s,l);else if("Text"==f){if(!P.init(r))return;if("MultiLineString"==h)for(var v=0;v<c.length;v++)P.place(c[v],t,e,n,i,o,a,s,l,u);else"LineString"==h&&P.place(c,t,e,n,i,o,a,s,l,u)}else if("LineString"==h)E(c,e,t);else if("Polygon"==h||"MultiLineString"==h)for(var g=0;g<c.length;g++)E(c[g],e,t);else if("MultiPolygon"==h)for(v=0;v<c.length;v++)for(g=0;g<c[v].length;g++)E(c[v][g],e,t);else if("MultiPoint"==h)for(var m=c.length;m--;)D(f,t.lon2x(c[m][0]),t.lat2y(c[m][1]),i,n,r,t,o,e,a,s,l)}},O=100,R="";function d(h,v,p){this.spawn=function(t,e,n,r,i,o,a,s,l){var u=this.createTask(t,e,n,r,i,n.bounds,o,a,s,l);return h.start(u),u},this.createTask=function(t,y,e,n,r,i,o,a,s,l){var u=r.index(n),c=r.getContext(u);return h.create({priority:t,delay:l,time:p,init:function(){if(!s){c.setTransform(v,0,0,v,0,0);var t=n.getStyle().backgroundColor;t?(c.fillStyle=t,c.globalAlpha=1,c.fillRect(0,0,256,256)):c.clearRect(0,0,256,256)}return{tile:e,ctx:c,data:o,lI:0,gI:0,fI:0,style:g,dTile:r,layer:n,bI:O}},onDone:function(){r.dirty(u),a(c,this)},exec:function(t){var e,n=t.tile,r=t.data,i=r.length;if(i){for(;!(e=r[t.lI])&&t.lI<i;)++t.lI;if(e){var o=e[t.gI];if(o){var a=t.ctx,s=o.shared,l=s.font!=g;if(t.style!=s){t.style=s;var u=m.init(a,s,r.swzs,n.z);if(t.pmap={},!u)return t.fI=0,t.gI++,t.bI=O,this.CONTINUE}for(;t.bI--;){var c=t.fI++,h=o.features[c];if(!h){l?a.setTransform(v,0,0,v,0,0):(s.fill&&a.fill(),s.stroke&&(s.strokeWidth||s.strokeWidth==g)&&a.stroke()),t.fI=0,t.gI++;break}var p=o.styles[c],f=void 0,d=void 0;(!l||(f="function"==typeof(d=p.textRef?M(p.textRef):p.text)?d(h):d)!==g&&f!==R)&&m.feature(n,a,h,f,p,t.dTile,t.layer,t.pmap,y,v)}}else t.fI=0,t.gI=0,t.lI++;return t.bI=O,this.CONTINUE}}}})}}var y,B,v=function(){function t(t,e){this.dpr=1,this.debug=!1,this.rz=0,this.sx=0,this.sy=0,this.s=1;var n=et.TaskManager.getInstance();this.ts=t,this.dpr=e,this.painter=new d(n,e,4)}return t.prototype.drawGrid=function(t,e,n){var r=n+"  L"+n.length,i=this.ctx;i.strokeRect(t,e,256,256),i.strokeText(r,t+8,e+16),i.fillText(r,t+8,e+16)},t.prototype.applyTransform=function(){var t=this,e=t.s,n=t.rz;if(t._s!=e||t._rz!=n){t._s=e,t._rz=n;var r=t.ctx,i=t.canvas,o=i.width,a=i.height,s=o/2-t.sx,l=a/2-t.sy,u=t.dpr;r.setTransform(1,0,0,1,o/2,a/2),r.rotate(n),r.translate(-o/2+s,-a/2+l),r.scale(e,e),r.translate(-s,-l),r.scale(u,u)}},t.prototype.init=function(t){var e=t.getContext("2d",{alpha:!1});e.font="bold 14px Arial",e.lineWidth=3,e.strokeStyle="red",e.fillStyle="white",e.textAlign="start",e.textBaseline="alphabetic",this.ctx=e,this.canvas=t},t.prototype.setBuckets=function(t){this.buckets=t},t.prototype.clear=function(){},t.prototype.setBackgroundColor=function(t){this.buckets.bgColor(t)},t.prototype.grid=function(t){this.debug=t},t.prototype.setScale=function(t,e,n){this.s=t,this.sx=e,this.sy=n},t.prototype.setRotation=function(t,e){this.rz=t},t.prototype.prepare=function(t,e,n,r,i,o){return this.painter.spawn(3,r,e,n,i,t,o)},t.prototype.tile=function(t,e,n){this.ctx.drawImage(t.combine(),e,n,256,256),this.debug&&this.drawGrid(e,n,t.quadkey)},t.prototype.preview=function(t,e,n,r){var i=t.getContext(r);i.clearRect(0,0,t.size,t.size);for(var o=0,a=e.length;o<a;o++){var s=e[o],l=this.buckets.get(s[0],!0),u=void 0;l&&(u=l.getData(r))&&(i.setTransform(1,0,0,1,0,0),i.drawImage(u,s[1],s[2],s[3],s[4],0+s[5],0+s[6],s[7],s[8]),t.dirty(r))}},t}(),Y=function(s){function t(t,e,n,r,i){var o=s.call(this)||this,a=n.length;return o.c=new Array(a),o.init(e,n,r),o.bPool=t,o.ctx=t.claimCtx(r),o.canvas=o.ctx.canvas,o.ctx.fillStyle=i,o}return u(t,s),t.prototype.destroy=function(t){if(t!=y)(e=this.c[t])&&(e.canvas&&this.bPool.releaseCtx(e),this.c[t]=y);else for(var e,n=this.c.length;n--;)(e=this.c[n])&&e.canvas&&(this.bPool.releaseCtx(e),this.c[n]=y)},t.prototype.init=function(t,e,n){s.prototype.init.call(this,t,e,n);var r=e.length;for(this.c.length=r;r--;)this.c[r]=y;this._c=!1,this._ready=!1},t.prototype.dirty=function(t,e){var n=this.c[t],r=e!=n;e&&n&&r&&this.destroy(t),e||(r=!0,e=this.c[t]),r&&(this.c[t]=e,this._c=!1)},t.prototype.clear=function(t){var e;(e=this.c[t])&&(e.setTransform&&this.bPool.releaseCtx(e),this.c[t]=y,this.preview(t,y),this.ready(t,!1),this._c=!1,this.combine())},t.prototype.getContext=function(t){return this.c[t]||(this.c[t]=this.bPool.claimCtx(this.size)),this.c[t]},t.prototype.getData=function(t){return this.c[t]&&(this.c[t].canvas||this.c[t])},t.prototype.combine=function(){var t,e=this,n=e.size;if(!e._c){e._c=!0,e.ctx.fillRect(0,0,n,n);for(var r=0;r<e.c.length;r++)(t=this.getData(r))&&e.ctx.drawImage(t,0,0,n,n)}return e.canvas},t.prototype.addLayer=function(t){s.prototype.addLayer.call(this,t);this.c.splice(t,0,y),this._c=!1,this._ready=!1},t.prototype.removeLayer=function(t){s.prototype.removeLayer.call(this,t);this.destroy(t),this.c.splice(t,1),this._c=!1},t}(function(){function t(){this.r=[],this.p=[]}return t.prototype.init=function(t,e,n){this.luTs=null,this.quadkey=t,this.size=n,this.layers=e,this.tasks={},this.r.length=0,this.p.length=0},t.prototype.busy=function(t){var e=t.id;for(var n in this.tasks)if(e==this.tasks[n]._lid)return!0},t.prototype.addTask=function(t,e){t._lid=e.id,this.tasks[t.id]=t},t.prototype.cancelTasks=function(t){var e,n=this.tasks;for(var r in n)e=n[r],t&&t.id!=e._lid||(e.cancel(),delete n[r])},t.prototype.removeTask=function(t,e){delete this.tasks[t.id]},t.prototype.index=function(t){return this.layers.indexOf(t)},t.prototype.ready=function(t,e){return 2==arguments.length&&(this.r[t]=e)&&(this.luTs=Date.now()),this.r[t]},t.prototype.addLayer=function(t){this.r.splice(t,0,!1),this.p.splice(t,0,void 0)},t.prototype.removeLayer=function(t){this.r.splice(t,1),this.p.splice(t,1)},t.prototype.preview=function(t,e){return 2==arguments.length&&(this.p[t]=e),this.p[t]},t}()),q=[],W={length:0,max:128,clear:function(){this.length=0},create:function(t){var e=document.createElement("canvas");return e.width=e.height=t,this.length++,e.getContext("2d")},get:function(t){return q.length?(this.length++,q.shift()):this.create(t)},release:function(t){t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.lineWidth=1,t.globalAlpha=1,q.push(t),this.length--},makeSpace:null},X=function(){function t(t){this.tiles=new et.LRU(t)}return t.prototype.get=function(t,e){return e?this.tiles._[t]&&this.tiles._[t].data:this.tiles.get(t)},t.prototype.forEach=function(t){return this.tiles.toArray().forEach(t)},t}(),G=function(r){function t(t,e){var n=r.call(this,t||256)||this;return n.ctxCache=W,n._bgc=null,n.tSize=e,n}return u(t,r),t.prototype.bgColor=function(e){this._bgc=e,this.forEach(function(t){t.ctx.fillStyle=e})},t.prototype.clear=function(){this.tiles.clear(),W.clear()},t.prototype.setSize=function(t){this.tiles.setSize(t)},t.prototype.releaseCtx=function(t){return W.release(t)},t.prototype.claimCtx=function(t){if(W.length<W.max)return W.get(t);var e=this.tiles.tail.data;return e.destroy(),W.release(e.ctx),e.ctx=null,e.canvas=null,this.tiles.remove(e.quadkey),e.cancelTasks(),this.claimCtx(t)},t.prototype.create=function(t,e){var n=this.tiles.get(t);return n||(this.tiles.length>=this.tiles.max?((n=this.tiles.tail.data).destroy(),n.init(t,e,this.tSize)):n=new Y(this,t,e,this.tSize,this._bgc),this.tiles.set(t,n)),n},t}(X),Q=function(t){this.ready=!1,this.cnt=0,this.layer=t},H=function(r){function i(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=r.apply(this,t)||this;return n.map={},Object.setPrototypeOf(n,i.prototype),n}return u(i,r),i.prototype.indexOf=function(t){var e=this.map[t.id];return r.prototype.indexOf.call(this,e)},i.prototype.add=function(t,e){var n=t.id,r=this.map[n];return r?(this.splice(this.indexOf(r),1),this.splice(e,0,r),!1):(r=this.map[n]=new Q(t),this.splice(e,0,r),!0)},i.prototype.remove=function(t){var e=this.indexOf(t);return-1!==e&&(this.splice(e,1),delete this.map[t.id]),e},i.prototype.get=function(t){return this.map[t]},i}(Array),J=function(){function t(t,e){this.display=t,this.render=e}return t.prototype.forEachTile=function(t,e){t._provider.getCachedTilesOfBBox(t.getBBox()).forEach(e)},t.prototype.remove=function(t,e,n){for(var r=0;r<e.length;r++)this.removeFromTile(t,e[r],n)},t.prototype.modifyInTile=function(t,e,n,r){var i=this.isVertexDataInitialized(e);return!!i&&(this.display.updateTile(e,i,r,t),!0)},t.prototype.isVertexDataInitialized=function(t){return this.display.getBucket(t.quadkey)},t.prototype.addToTile=function(t,e,n){var r=this.isVertexDataInitialized(e);r&&this.display.updateTile(e,r,n,t)},t.prototype.removeFromTile=function(t,e,n){var r=this.isVertexDataInitialized(e);r&&this.display.updateTile(e,r,n,t)},t.prototype.add=function(t,e,n){if(e)for(var r=0;r<e.length;r++)this.addToTile(t,e[r],n)},t.prototype.updateGeometry=function(t,e,n,r){for(var i=r.getProvider(),o=i.getCachedTilesOfBBox(e),a=i.getCachedTilesOfBBox(t.getBBox()),s=0,l=a.length;s<l;s++){var u=o.indexOf(a[s]);-1===u?this.addToTile(t,a[s],r):(this.modifyInTile(t,a[s],n,r),o.splice(u,1))}for(s=0,l=o.length;s<l;s++)this.removeFromTile(t,o[s],r),this.removeFromTile(t,o[s],r)},t.prototype.repaint=function(n,t,r){var i=this;i.forEachTile(n,function(t){var e=i.isVertexDataInitialized(t);e?i.display.updateTile(t,e,r,n):t.preview&&(t.preview=void 0)})},t.prototype.clear=function(e,n){n=n||[];var t=this.display,r=t.layers.indexOf(e);t.buckets.forEach(function(t){n.length&&!function(t,e){for(var n,r,i=t.length,o=0;o<e.length;o++)if(r=t,n=e[o],i>e[o].length&&(n=r,r=e[o]),0===n.search(r))return!0}(t.quadkey,n)||(t.clear(r),t.ready(r,!1),t.cancelTasks(e),t.luTs=null)}),t.update()},t}(),$=e.tile.Utils,K=[],tt=function(){function t(t,e){this.display=t,this.up="number"==typeof e?this.down=e:(this.down=e[0],e[1])}return t.prototype.lookUp=function(t,e,n,r,i){var o,a,s,l=t.quadkey,u=t.size,c=e-n;if(o=Number(l[c]),i.x+=o%2*u/2,i.y+=Number(1<o)*u/2,s=l.substring(0,c),this.hasData(s,r)){var h=u/Math.pow(2,n);return a=[],this.add(a,s,i.x,i.y,h,0,0,u),a}i.x/=2,i.y/=2},t.prototype.add=function(t,e,n,r,i,o,a,s){t.push([e,n,r,i,i,0^o,0^a,s,s])},t.prototype.hasData=function(t,e){var n=this.display.buckets.get(t,!0);if(n)return n.ready(e)&&n.getData(e)},t.prototype.lookDown=function(t,e,n,r){var i,o,a,s,l,u,c=t.size,h=e+n;i=$.getTilesOfLevel(t.quadkey,h);for(var p=0;p<i.length;p++){o=a=0,s=c;for(var f=0;f<n;f++)s/=2,o+=(l=i[p][e+f])%2*s,a+=Number(1<l)*s,f==n-1&&this.hasData(i[p],r)&&(u=u||[],this.add(u,i[p],0,0,c,o,a,s))}return u},t.prototype.create=function(t,e,n,r){var i,o=t.quadkey.length,a=e.min,s=e.max,l=s-o,u=o-a,c={x:0,y:0},h=0;n=n||this.down,u<(r=r||this.up)&&(r=u),l<n&&(n=l);for(var p=n<r?r:n,f=t.index(e);h++<p;){if(a<=o-h&&(i=this.lookUp(t,o,h,f,c)))return i;if(o+h<=s&&h<n&&(i=this.lookDown(t,o,h,f)))return i}return K},t}(),rt=function(){return 1},it="*",ot=function(){function t(t,e){this.tm=t,this.ms=e}return t.prototype.exclusiveRuntime=function(t){this.ms=t},t.prototype.spawn=function(t,e,n,r,i,o,a){var s=this.createTask(t,e,n,r,i,o);return this.tm.start(s,a),s},t.prototype.createTask=function(t,n,r,i,o,a){var s=[],l=this.ms,u=this.tm.create({time:l,priority:t,init:function(){if(i){for(var t=i.length,e=Date.now();t--;)i[t];u.time=l-(Date.now()-e)}return[r,i,o,0,s,300,n,{}]},name:"cluster",onDone:function(){var t=n.getStyle(),e=t&&(t.strokeWidthZoomScale||t.LineStringZoomScale)||rt;s.swzs=e(r.z),a(s,this)},exec:function(t){var e,n,r,i,o,a,s,l,u,c,h,p,f,d,y,v,g,m,x,w=t[0],L=t[1],M=t[2],b=t[6],T=L.length,z=t[4],S=w.z;if(L&&!(t[3]>=T)){for(;t[5]--&&(o=L[t[3]++]);)if(!M[a=o.id]&&(M[a]=!0,r=b.getStyleGroup(o,S))){r.length||(r=[r]);for(var C=0,k=r.length;C<k;C++)i=r[C],(D=i).type&&D.zIndex!=N&&(e=I("zIndex",i,o,S),s=I("type",i,o,S),y=I("opacity",i,o,S),x=g=v=m=d=f=h=p=B,"Image"==s?n="I":(h=I("fill",i,o,S),f=I("stroke",i,o,S),d=I("strokeWidth",i,o,S),n="Line"==s?(v=I("strokeLinecap",i,o,S),g=I("strokeLinejoin",i,o,S),m=I("strokeDasharray",i,o,S),"L"+(v||it)+(g||it)+(m||it)):"Text"==s?"T"+((p=I("font",i,o,S)||"normal 12px Arial")||it):"Circle"==s?"C"+I("radius",i,o,S)||it:"R"+(x=I("width",i,o,S))+(I("height",i,o,S)||x),n+=(f||it)+(d||it)+(h||it)),y!=B&&(n+=100*y^0),(u=(c=(l=z[e]=z[e]||[])[n])==B?(c=l[n]=l.length,l[c]={shared:{font:p,fill:h,opacity:y,stroke:f,strokeWidth:d,strokeLinecap:v,strokeLinejoin:g,strokeDasharray:m},features:[],styles:[]}):l[c]).features.push(o),u.styles.push(i))}var D;return t[5]=300,t[3]<T}}});return u},t}();function at(t,e,n){if(e[t+="EventListener"])for(var r in n)e[t](r,n[r])}var st,lt=function(){function T(t,e,n,r,i,o){this.updating=!1,this.dirty=!1,this.globalBgc=!1;var a,s,l,u,c,h,p,f,d,y,v,g,m,x=this,w=nt(t,"width"),L=nt(t,"height"),M=(a=t,s=w,l=L,u=0,g=document.createElement("canvas"),m=g.style,f=s,d=l,(p=g).setAttribute("width",f),p.setAttribute("height",d),g.setAttribute("oncontextmenu","return false;"),y=g,v="none",["-webkit-user-select","-moz-user-select","-ms-user-select","user-select"].forEach(function(t){y.style[t]=v}),m.top=m.left="0px",m.position="absolute",1!=c&&(m.opacity=String(c)),a.querySelectorAll("canvas[type=layer]"),g.setAttribute("type","layer"),(h=a.querySelectorAll("canvas")[u])?a.insertBefore(g,h):a.appendChild(g),g);this.previewer=new tt(x,o),this.cluster=new ot(et.TaskManager.getInstance(),4),M.className="tmc",x.render=i,x.tileSize=e,x.buckets=r,x.layers=new H,x.w=w,x.h=L,x.canvas=M,x.dpr=T.getPixelRatio(n),x.setSize(w,L),x.setBGColor();var b=new J(x,i);x.listeners={clear:b.clear.bind(b),featureAdd:b.add.bind(b),featureRemove:b.remove.bind(b),featureCoordinatesChange:b.updateGeometry.bind(b),styleGroupChange:b.repaint.bind(b),styleChange:function(t,e){x.setLayerBgColor(e)}}}return T.getPixelRatio=function(t){return 0^((t="auto"==t?Math.min(2,et.global.devicePixelRatio||1):t||1)<1?1:t)},T.prototype.addLayer=function(t,e,n){var r=!1;return this.layers.add(t,n)&&(at("add",t,this.listeners),0==n&&this.setLayerBgColor(t),this.buckets.forEach(function(t){t.addLayer(n)}),r=!0),r},T.prototype.removeLayer=function(e){var n=this.layers.remove(e);return-1!==n&&(this.buckets.forEach(function(t){t.cancelTasks(e),t.removeLayer(n)}),at("remove",e,this.listeners)),n},T.prototype.getBucket=function(t,e){return e?this.buckets.create(t,this.layers):this.buckets.get(t)},T.prototype.handleTile=function(n,t,e,r){var i,o=this,a=!1;if(e?a=!0:e=o.getBucket(n.quadkey,!0),null==r&&(r=o.layers.indexOf(t)),n.error&&(o.layers[r].error=!0),!e.ready(r)&&!e.busy(t)&&(i=n.data)){var s=function(t,e){n.isLoaded()&&t.ready(t.index(e),!0),o.update(a)};e.ready(r,!1),t.render?t.render(n,i,t,e,s):o.prepareTile(n,i,t,e,s)}},T.prototype.setLayerBgColor=function(t){var e=t.getStyle().backgroundColor;!this.globalBgc&&e&&this.render.setBackgroundColor(e)},T.prototype.isVisible=function(t){for(var e=t.quadkey,n=this.quads,r=0;r<n.length;r++)if(n[r][0]==e)return!0;return!1},T.prototype.updateTile=function(t,e,n,r){if(e&&!e.busy(n)){var i=e.index(n);e.ready(i,!1),this.isVisible(t)&&this.handleTile(t,n,e,i)}},T.prototype.setSize=function(t,e){var n=this.dpr,r=this.canvas;this.w=t,this.h=e,r.width=t*n,r.height=e*n,r.style.width=t+"px",r.style.height=e+"px"},T.prototype.cancel=function(t,e){var n=this.buckets.get(t,!0);n&&n.cancelTasks(e)},T.prototype.preview=function(t,e,n){var r=this.previewer.create(t,e);return t.preview(n,r),r},T.prototype.initViewport=function(t,e,n){var r,i=this.layers,o=i.length;this.dirty=!0;for(var a,s,l=0;l<o;l++){s=(a=i[l]).layer,a.error=!1,a.ready=!1,a.cnt=0,a.visible=n>=s.min&&n<=s.max;for(var u=0,c=void 0,h=void 0;u<t.length;u++)c=t[u][0],h=this.getBucket(c,!0),t[u][3]=!0,r=h.ready(l),a.visible?r||h.preview(l)||this.preview(h,s,l):h.ready(l,!0)}this.quads=t},T.prototype.viewport=function(t){var e,n,r,i,o=this.quads,a=this.render,s=o.length,l=this.layers,u=l.length,c=this.buckets,h=0;for((this.dirty||t)&&(this.render.clear(),this.dirty=!1);h<s;){if(n=o[h],(e=this.getBucket(n[0]))&&(r=n[1],i=n[2],n[3]!=e.luTs||t)){n[3]=e.luTs,a.tile(e,r,i,c);for(var p,f=0;f<u;f++)!(p=l[f]).ready&&e.ready(f)&&++p.cnt==s&&(p.ready=!0)}h++}},T.prototype.update=function(t){var e=this;e.updating||(e.updating=!0,requestAnimationFrame(function(){e.viewport(t),e.updating=!1}))},T.prototype.setBGColor=function(t){t&&(this.globalBgc=!0),"rgba(0, 0, 0, 0)"!=(t=t||et.global.getComputedStyle(this.canvas.parentElement,null).getPropertyValue("background-color"))&&"transparent"!=t||(t="#ffffff"),this.render.setBackgroundColor(t)},T.prototype.showGrid=function(t){this.render.grid(!!t)},T.prototype.setTransform=function(t,e,n){this.render.setScale(this.s=t,0,0),this.render.setRotation(this.rz=e,this.rx=n),this.render.applyTransform()},T.prototype.getLayers=function(){return this.layers},T.prototype.destroy=function(){var t=this.canvas;t.parentElement.removeChild(t)},T.prototype.clearLayer=function(t){var e=this.getLayers().indexOf(t);this.buckets.forEach(function(t){t.preview(e,!1),t.ready(e,!1)})},T}(),ut={1:[512,3,512],2:[128,2,128],3:[64,1,128]},ct=function(t,e,n,r,i){var o=Math.sin(i),a=Math.cos(i),s=t-n,l=e-r;return[a*s-o*l+n,o*s+a*l+r]},ht=function(l){function t(t,e,n){var r;e=e||256,n=lt.getPixelRatio(n);var i=ut[n][1],o=new v(e*n,n),a=ut[n][0],s=new G(a,e*n);return o.setBuckets(s),r=l.call(this,t,e,n,s,o,i)||this,o.init(r.canvas),r}return u(t,l),t.prototype.preview=function(t,e,n){var r=l.prototype.preview.call(this,t,e,n);return r&&this.render.preview(t,r,e,n),r},t.prototype.prepareTile=function(n,t,r,i,o){var a=this,s=a.render;if("image"==n.type){var e=i.index(r);i.dirty(e,t),o(i,r)}else if(t.length)i.addTask(a.cluster.spawn(4,r,n,t,{},function(t,e){i.removeTask(e,r),null==i&&(i=void 0),i.addTask(s.prepare(t,n,r,a,i,function(t,e){i.removeTask(e,r),o(i,r)}),r)}),r);else{e=i.index(r);i.destroy(e),i.dirty(e),o(i,r)}},t.prototype.addLayer=function(t,e,n){var r=l.prototype.addLayer.call(this,t,e,n);return r&&this.setupTilePool(),r},t.prototype.removeLayer=function(t){var e=l.prototype.removeLayer.call(this,t);return-1!==e&&this.setupTilePool(),e},t.prototype.setSize=function(t,e){var n=this;l.prototype.setSize.call(this,t,e),n.setupTilePool(),n.render._s=void 0,n.setTransform(n.s,n.rz,n.rx)},t.prototype.destroy=function(){l.prototype.destroy.call(this),this.buckets.clear()},t.prototype.setupTilePool=function(){var t=this,e=(Math.ceil(t.w/256)+1)*(Math.ceil(t.h/256)+1),n=e,r=ut[t.dpr],i=e*t.getLayers().length;n<r[0]&&(n=r[0]),t.buckets.setSize(n),i<r[2]&&(i=r[2]),t.buckets.ctxCache.max=i},t.prototype.update=function(t){l.prototype.update.call(this)},t.prototype.project=function(t,e,n,r){var i=this.s;return ct(t*=i,e*=i,this.w/2,this.h/2,this.rz)},t.prototype.unproject=function(t,e){var n=this.s,r=this.w/2,i=this.h/2,o=ct(t,e,r,i,-this.rz);return o[0]=(o[0]-r)/n+r,o[1]=(o[1]-i)/n+i,o},t}(lt);function pt(c,a,o,s,l){var e=!1,u=0^l.zoomAnimationMs;function h(t){var e,n,r=t.targetTouches;if(r){var i=r.length,o=r[i-1],a=void 0;if(i){var s=c.getBoundingClientRect(),l=o.pageX-s.left,u=o.pageY-s.top;n=1<i?(e=(l+(a=r[i-2]).pageX-s.left)/2,(u+a.pageY-s.top)/2):(e=l,u)}}else e=t.clientX,n=t.clientY;return[0^e,0^n]}function p(t,e,n,r){return Math.sqrt(Math.pow(t-n,2)+Math.pow(e-r,2))}var f=null;function d(t){var e=1;if(t.scale!=st)return t.scale;var n=t.targetTouches,r=n.length,i=n[r-1],o=n[r-2];if(o){var a=p(i.clientX,i.clientY,o.clientX,o.clientY);null==f&&(f=a),e=a/f}return e}var y,v,g,m,x,w,L,M,b,T=8;function n(t){for(var e=0,n=t.length;n--;e+=t[n]);return e}var z,S;function r(t,e){if(!x){var n=l.minPanMapThreshold;if(Math.abs(t-y)<n&&Math.abs(e-v)<n)return!0;o.cancel()}if(w=Date.now(),s.drag&&!a.lockViewport().pan){var r=t-g,i=e-m;b<T?(L[b]=r,M[b]=i,b++):b=0,a.pan(r,i),x=!0}g=t,m=e}function C(t){if(x){var e=Date.now();e-w<25&&o.pan(e,3*n(L),3*n(M))}}function k(t){h(t),b=0,L=[],M=[]}function i(t){k(t);var e=t.targetTouches,n=e.length,r=h(t);if(g=r[0],m=r[1],y=g,v=m,d(t),x=!1,2==n){var i=e[n-1],o=e[n-2];f=p(i.clientX,i.clientY,o.clientX,o.clientY),S=a.getZoomlevel(),z=a.rotate(),function(t){if(t.rotation!=st)return t.rotation;var e=t.targetTouches,n=e.length,r=e[n-1],i=e[n-2];if(i){var o=i.clientX-r.clientX,a=i.clientY-r.clientY;return 180*Math.atan2(a,o)/Math.PI}}(t)}}function D(t){var e=h(t),n=d(t);r(e[0],e[1]),1<t.targetTouches.length&&(O(S+Math.log2(n),e[0],e[1],!1),n),g=e[0],m=e[1],t.preventDefault()}var N=Date.now();function I(t){var e=h(t),n=t.targetTouches.length;e&&(g=e[0],m=e[1],y=g,v=m),n<2&&(f=null);var r=Date.now(),i=r-N;n&&(N=r),d(t),0==n&&1==t.changedTouches.length&&350<i&&C()}var j=null;function E(t){j=t.button,k(t),x=!1,_(c,"mousemove",P),z=a.rotate(),g=t.clientX,m=t.clientY,y=g,v=m}function P(t){0==j?r(t.clientX,t.clientY):2==j&&e&&a.rotate(z+.7*(g-t.clientX))}function A(t){j=null,Z(c,"mousemove",P),x&&C()}function O(t,e,n,r){var i=a.lockViewport();if(t>=i.minLevel&&t<=i.maxLevel){var o=r&&u;a.setZoomlevel(t,e,n,o,r)}}function R(t,e){if(s.zoom)if((t=t||WIN.event).shiftKey){if(e=t.wheelDelta?t.wheelDelta/120:(-t.detail||0)/3){var n=c.getBoundingClientRect();a.setZoomlevel(a.getZoomlevel()+(0<e?.1:-.1),t.pageX-n.left,t.pageY-n.top)}}else!function(t,e){if(e=(t=t||WIN.event).wheelDelta?-t.wheelDelta/120:(t.detail||0)/3){var n=Math.round(a.getZoomlevel()+(e<0?1:-1)),r=c.getBoundingClientRect();O(n,t.pageX-r.left,t.pageY-r.top,!0)}t.preventDefault&&t.preventDefault(),t.returnValue=!1}(t,e)}function B(){a.resize(c.offsetWidth,c.offsetHeight)}this.rotate=function(t){e=!!t},this.drag=function(t){var e=t?_:Z;setTimeout(function(){e(c,"touchstart",i),e(window,"touchend",I),e(c,"touchmove",D),e(c,"mousedown",E),e(window,"mouseup",A)},0)},this.scroll=function(t){(t?_:Z)(c,["mousewheel","DOMMouseScroll"],R)},this.resize=function(t){(t?_:Z)(window,"resize",B)}}var ft,dt=null;function yt(t,e){this.type=t,this.timeStamp=Date.now(),e!=ft&&(this.data=this.detail=e)}var vt=yt.prototype;vt.nativeEvent=dt,vt.detail=dt,vt.data=dt,vt.target=dt,vt.mapX=dt,vt.mapY=dt,vt.type=dt,vt.button=dt,vt.timeStamp=dt,vt.toString=function(){return"TigerEvent "+this.type},vt.stopPropagation=function(){var t=this.nativeEvent;if(t._stopPropagation=!0,"mousemove"==t.type||"touchmove"==t.type)return t.stopImmediatePropagation(),t.preventDefault()};var gt=250;function mt(a,s,t,o){var l,u,c=!1,h=!1,p=new et.Listener("click");p.sync(!0);var r,i="pointerup",f="pointerenter",d="pointerleave",e="pointerdown",y="pointermove",v="pressmove",g="tap",m="dbltap",n=[i,f,d,e,y,v,g,m],x={};function w(t){return-1!==n.indexOf(t)}function L(t){r=s.getCenter(),c=!(h=!0),l=C(t),u=E(l),D(e,t,l,u),"touchstart"==t.type&&t.target.parentNode==a&&t.preventDefault()}function M(t){var e,n,r;if(h){var i=o.minPanMapThreshold;if(!c&&(n=(e=C(t))[0]-l[0],r=e[1]-l[1],Math.abs(n)<i&&Math.abs(r)<i))return}c=!0,h?u&&p.isListened(v)&&(n=(e=C(t))[0]-l[0],r=e[1]-l[1],p.trigger(v,[k(v,t,e[0],e[1],u),n,r],!1)):"touchmove"!=t.type&&(p.isListened(f)||p.isListened(d)||p.isListened(y))&&(N=t,x.pointerenter||x.pointerleave||I||(I=!0,j.start()))}function b(t){if(h){var e=s.getCenter();if(!(r.longitude!=e.longitude||r.latitude!=e.latitude)&&t.target.parentNode==a&&(u||!c)){var n=C(t);D(g,t,n,u),D(i,t,n,u),function(t){var e=Date.now(),n=u&&u.feature;e-S<gt&&!c&&T==n&&D(m,t,l,u);T=n,S=e}(t)}h=c=!1}}n.forEach(function(t){p.addEvent(t),x[t]=!1});var T,z,S=0;function C(t){var e=t.type;"touchstart"!=e&&"touchmove"!=e&&"touchend"!=e||(t=t.changedTouches[t.changedTouches.length-1]);var n=a.getBoundingClientRect();return[t.pageX-n.left,t.pageY-n.top]}function k(t,e,n,r,i){var o=new yt(t,i);return o.mapX=n,o.mapY=r,o.nativeEvent=e,i&&(o.target=i.feature,o.detail.display=s),o.button=e.button,o}function D(t,e,n,r){p.trigger(t,[k(t,e,n[0],n[1],r)],!1)}var N,I=!1,j=et.TaskManager.getInstance().create({delay:40,prority:5,exec:function(){!function(t){var e=C(t),n=E(e);D(y,t,e,n),n?z?z.feature.id!==n.feature.id&&(D(d,t,e,z),D(f,t,e,n)):D(f,t,e,n):z&&D(d,t,e,z);z=n}(N),I=!1}});function E(t){return s.getFeatureAt({x:t[0],y:t[1]},{layers:s.layers.filter(function(t){return t.pointerEvents()})})}var P=0,A=!1;function O(){return{touchstart:L,touchmove:M,touchend:b,mousedown:L,mouseup:b,mousemove:M}}this.enable=function(t){w(t)&&delete x[t]},this.disable=function(t){w(t)&&(x[t]=!0)},this.destroy=function(){var t=O();if(A){for(var e in t)Z(a,e,t[e]);A=!1}},this.addEventListener=function(t,e,n){if(w(t)&&p.add(t,e,n)){P++;var r=O(),i=void 0;if(!A)for(var t in r){i=r[t];var o=a;if("mouseup"==t)for(;o.parentNode;)o=o.parentNode;_(o,t,i),A=!0}}},this.removeEventListener=function(t,e,n){if(w(t)&&p.remove(t,e,n)&&!--P&&A){var r=O();for(var t in r)p.isListened(t)||Z(a,t,r[t]);A=!1}}}var xt=function(){function t(t){this.map=t}return t.prototype.feature=function(t,e,n,r,i){return this.geometry(t,e,n.getProvider().decCoord(n),n.geometry.type,r,n,i)},t.prototype.geometry=function(t,e,n,r,i,o,a,s){var l,u,c,h,p,f,d,y,v,g,m,x,w,L,M,b,T,z,S,C=!1,k=this.map;if("Point"==r){if(s=s||V(i,o,a)){var D=k.geoToPixel(n[0],n[1]),N=Math.round(D.x+s[0]),I=Math.round(D.y+s[1]),j=Math.round(D.x+s[2]),E=Math.round(D.y+s[3]);b=e,T=j,z=I,S=E,C=N<=(M=t)&&M<=T&&z<=b&&b<=S}}else if("LineString"==r){for(var P=(s=s||U(i,o,a))[0],A=n.length,O=1/0,R=k.geoToPixel(n[0][0],n[0][1]),B=void 0,_=void 0,Z=1;Z<A;Z++)B=k.geoToPixel(n[Z][0],n[Z][1]),l=t,u=e,c=R.x,h=R.y,p=B.x,f=B.y,L=g=v=y=d=void 0,L=-1,0!=(w=(m=p-c)*m+(x=f-h)*x)&&(L=((l-c)*m+(u-h)*x)/w),y=L<0?(d=c,h):1<L?(d=p,f):(d=c+L*m,h+L*x),v=l-d,g=u-y,(_=Math.sqrt(v*v+g*g))<O&&(O=_),R=B;C=O<=P/2}else if("Polygon"==r){var Y=n[0],q=k.pixelToGeo(t,e);(C=function(t,e,n){for(var r,i,o,a,s=!1,l=0,u=n.length-1;l<n.length;u=l++)r=n[l][0],o=n[l][1],i=n[u][0],e<o!=e<(a=n[u][1])&&t<(i-r)*(e-o)/(a-o)+r&&(s=!s);return s}(q.longitude,q.latitude,Y))&&(s=s||[F(i,o,a)])}else{var W=void 0;if("MultiPolygon"==r?(W="Polygon",s=[F(i,o,a)]):"MultiPoint"==r?(W="Point",s=V(i,o,a)):"MultiLineString"==r&&(W="LineString",s=U(i,o,a)),W)for(var X=0,G=n.length;X<G;X++)if(this.geometry(t,e,n[X],W,i,o,a,s)){C=!0;break}}return C&&s},t}(),wt=32;function Lt(t){return"number"==typeof t}function Mt(j){var E=new xt(j);this.search=function(t,e,n,r,i,o){var a=j.getZoomlevel(),s=j.layers;if(i=i?i instanceof Array?i.slice().sort(function(t,e){return s.indexOf(t)>s.indexOf(e)}):[i]:s,Lt(t)&&Lt(e)&&Lt(n)&&Lt(r)){return function(t,e,n,r,i,o,a){for(var s,l,u,c,h,p,f,d,y=t+(n-t)/2,v=e+(r-e)/2,g=180,m=-180,x=180,w=-180,L=[j.pixelToGeo(t,e),j.pixelToGeo(n,e),j.pixelToGeo(n,r),j.pixelToGeo(t,r)],M=4,b=[];M--;){var T=L[M].longitude,z=L[M].latitude;T<g&&(g=T),m<T&&(m=T),z<x&&(x=z),w<z&&(w=z)}s=[g,x,m,w];for(var S=i.length;S--;){l=(u=i[S]).getProvider(o);var C=[],k=0;if(o<=u.max&&o>=u.min&&l.search){p=(h=l.search(s))&&h.length;for(var D={};c=h[--p];)if((f=u.getStyleGroup(c,o))&&(d=E.feature(y,v,c,f,o))){var N=d.pop();k<N&&(k=N),D[N]?a||D[N].push(c):D[N]=[c]}if(a&&D[k])return[{layer:u,features:D[k]}];for(var I in D)C=C.concat(D[I]);C.length&&b.push({layer:u,features:C})}}return b.reverse()}(t-wt,e-wt,n+wt,r+wt,i,a,o)}}}var bt="mapviewchange",Tt=bt+"start",zt=bt+"end",St=1e3/30,Ct=100;function kt(t){if("function"==typeof Event)var e=new Event(t);else(e=document.createEvent("Event")).initEvent(t,!0,!0);return e}var Dt,Nt=!0;function It(c,h,l){var p,f,d,y,v,g,m=null;function x(){if(g){g=!1;var t=c.getCenter();h(zt,{changed:{center:t.longitude!=d.longitude||t.latitude!=d.latitude}},Nt)}for(var e,n,r,i=l.getLayers(),o=!0,a=0;a<i.length;a++)if(r=(e=(n=i[a]).layer).id,n.ready){if(!y[r]&&(y[r]=!0,!n.error)){var s=kt("viewportReady");s.detail=s.data={map:c,layer:e},e._l.trigger("viewportReady",[s],!0)}}else o=!1;o||(v=setTimeout(x,Ct))}function e(){var t,e,n,r,i,o=c.getViewBounds(),a=c.getCenter(),s=c.rotate(),l=bt,u={changed:{center:!0}};if(p){if(u.changed.center=a.longitude!=d.longitude||a.latitude!=d.latitude,e=f,n=o,r=s,i=!0,(t=p).minLon==n.minLon&&t.maxLon==n.maxLon&&t.minLat==n.minLat&&t.maxLat==n.maxLat&&e==r||(i=!1),i)return clearInterval(m),m=p=f=null,v&&clearTimeout(v),v=setTimeout(x,Ct);p=o,f=s,d=a}else y={},l=Tt,p=o,f=s,d=a,g=!0;h(l,u,Nt)}this.watch=function(t){v&&(clearTimeout(v),v=null),t?m||(m=setInterval(e,St)):m&&(clearInterval(m),m=null)}}var jt=function(){function t(t,e,n){this._v=!0;var r=this;r.display=n,r.cPrefix=t.className+"-ui-",r.parent=t,(r.opt=e).visible&&(r.create(t,e),r.enable())}return t.prototype.show=function(){var t=this;t.html||t.create(t.parent,t.opt),t.html.style.display="inline"},t.prototype.hide=function(){var t=this.html;t&&(t.style.display="none")},t.prototype.enable=function(){this.toggleListeners(!0)},t.prototype.disable=function(){this.toggleListeners(!1)},t.prototype.toggleListeners=function(t){var e=this,n=e.listeners,r=(t?"add":"remove")+"EventListener";for(var i in n){var o=e.querySelectorAll(i);for(var a in n[i])o.forEach(function(t){t[r](a,n[i][a].bind(e))})}},t.prototype.insertRule=function(t,e){var n,r=(Dt=Dt||(n=document.createElement("style"),document.head.appendChild(n),n)).sheet;r.insertRule?r.insertRule(t+" {"+e+"}",r.cssRules.length):r.addRule&&r.addRule(t,e)},t.prototype.create=function(t,e){var n=this.templ.replace(/class\=\"/g,'class="'+this.cPrefix);n=n.replace(/\>[\s]+\</g,"><");var r,i=(r=n,(new DOMParser).parseFromString(r,"text/html").body.childNodes[0]),o=i.style,a=e.position,s="."+t.className+" ";for(var l in a)o[l]=a[l];if(this.style)for(var u in this.style)this.insertRule(s+this.prefixClass(u),this.style[u]);this.html=t.appendChild(i)},t.prototype.prefixClass=function(t){return t=t.replace(/\./g,"."+this.cPrefix)},t.prototype.querySelector=function(t){return this.html.querySelector(this.prefixClass(t))},t.prototype.querySelectorAll=function(t){return this.html.querySelectorAll(this.prefixClass(t))},t}(),Et=function(a){function t(t,e,n,r){var i=a.call(this,t,e,n)||this,o=i;return r&&r.zoomAnimationMs&&(o.ams=r.zoomAnimationMs),i}return u(t,a),t.prototype.enable=function(){a.prototype.enable.call(this);var e=this.querySelector(".info"),n=this.display;e.innerText=n.getZoomlevel(),n.addEventListener("mapviewchangeend",this._zll=function(t){e.innerText=Math.round(100*n.getZoomlevel())/100})},t.prototype.disable=function(){a.prototype.disable.call(this),this.display.removeEventListener("mapviewchangeend",this._zll)},t}(jt);Et.prototype.listeners={".zoomBtn":{click:function(t){var e=0^t.srcElement.getAttribute("dir");this.display.setZoomlevel(this.display.getZoomlevel()+e,this.ams)}}},Et.prototype.style={".zoomctrl":"        position: absolute;        right:  10px;        bottom: 20px;        text-align: center;        font-family: sans-serif;        color: white;        user-select: none;",".zoomctrl div":"        background-color: #0f1621;        border-radius: 4px;        font-size: 12px;        width: 28px;        margin: 2px;",".zoomctrl .zoomBtn":"        height: 28px;        font-size: 32px;        /* border: 1px solid white; */        line-height: 22px;        font-weight: 200;",".zoomctrl .zoomBtn:hover":"        background-color: #383c45;        cursor: pointer;"},Et.prototype.templ='<div class="zoomctrl">         <div class="zoomBtn" dir="1">+</div>         <div class="info">L</div>        <div class="zoomBtn" dir="-1">-</div>     </div>';var Pt=function(r){function t(t,e,n){return r.call(this,t,e,n)||this}return u(t,r),t.prototype.add=function(t){var e,n,r,i,o;e="div",n=this.prefixClass(".src").substr(1),r="© "+t.label,i=this.html,o=document.createElement(e),n&&(o.className=n),r&&(o.innerText=r),i&&i.appendChild(o)},t.prototype.setData=function(t){if(this.data=t,this.html){this.html.innerText="";for(var e=0,n=t;e<n.length;e++){var r=n[e];this.add(r)}}},t}(jt);Pt.prototype.style={".copyright-popup":"        user-select: none;        background-color: rgba(0,0,0,0.1);        position: absolute;        bottom: 15px;        padding: 2px;        right: 120px;        z-index: 1;        width:  auto;        color: #fff;        font-family: arial;        font-size: 11px;        opacity: 0.8;        height: auto;",".src":"        opacity: 0.8;        margin: 4px;    "},Pt.prototype.templ='<div class="copyright-popup"></div>';var At=et.global.document,Ot="addLayer removeLayer",Rt="zoomlevel",Bt=function(t,e){var n,r,i,o=t.scopes,a=o.length;if(!a)return!0;for(;n=o[--a];){var s=n.layer.getProvider(e).level||e;if(r=n.minLevel||-1/0,i=n.maxLevel||1/0,r<=s&&s<=i)return!0}return!1},_t=function(t,e){t.style.display=e?"inline":"none"},Zt=function(o){function t(t,e,n){var r=o.call(this,t,e,n)||this;r.sources=new et.Map,r.sLen=0,r.srcWidth=0;var i=r;return i.$src=i.querySelector(".sources"),i.$here=i.querySelector(".here"),i.$btn=i.querySelector(".btn"),r.details=new Pt(t,{visible:!1},n),r}return u(t,o),t.prototype.enable=function(){var r=this;o.prototype.enable.call(this),r.display.addObserver(Rt,r.onZoomChange=function(t,e,n){e%1||(r.sources.forEach(function(t){_t(t.el,Bt(t,e))}),r.showDetails(!1),r.handleOverflow())}),r.display.addEventListener(Ot,r.onLayerChange=function(e){var n=e.detail.layer;n.getCopyright(function(t){"addLayer"==e.type?t.forEach(function(t){return r.addSource(t,n)}):t.forEach(function(t){return r.removeSource(t,n)})})}),r.display.addEventListener("resize",r.onResize=function(){return r.handleOverflow()})},t.prototype.disable=function(){var t=this;o.prototype.disable.call(this),t.display.removeObserver(Rt,t.onZoomChange),t.display.removeEventListener(Ot,t.onLayerChange),t.display.removeEventListener("resize",t.onResize)},t.prototype.calcWidth=function(){var e=0^this.display.getZoomlevel(),t=this.sources,n=0;return t.forEach(function(t){n+=Bt(t,e)&&t.width}),n},t.prototype.handleOverflow=function(){var t=this,e=t.$btn,n=t.display.getWidth(),r=t.calcWidth(),i=n-132^0;t.$src.style.width=(i<r?i-10:r)+"px",r>Math.min(i,384)?_t(e,!0):(_t(e,!1),t.showDetails(!1))},t.prototype.showDetails=function(t){var e=this.details,n=this.display.getZoomlevel();this.$btn.innerText=t?"-":"+",t?(e.show(),e.setData(this.sources.values().filter(function(t){return Bt(t,n)}))):e.hide()},t.prototype.addSource=function(t,e){var n,r=this,i=r.sources,o=t.label,a=t.scopes,s=0^r.display.getZoomlevel(),l=i.get(o);l?(n=l.el,l.cnt++):((n=At.createElement("span")).className=this.prefixClass(".source").substr(1),n.innerText="© "+o,r.$src.appendChild(n),l={label:o,scopes:[],el:n,cnt:1,width:n.getBoundingClientRect().width},i.set(o,l),r.sLen++,r.srcWidth+=l.width),null!=a&&a.forEach(function(t){return l.scopes.push({minLevel:t.minLevel,maxLevel:t.maxLevel,layer:e})}),_t(r.$here,!1),_t(n,Bt(l,s)),r.handleOverflow()},t.prototype.removeSource=function(t,e){var n,r,i=this,o=t.label,a=i.sources.get(o);if(a){if(r=a.scopes,n=t.scopes)for(var s=0,l=void 0;s<n.length;s++){l=n[s];for(var u=0,c=void 0;s<r.length;u++)if((c=r[u]).layer==e&&c.minLevel==l.minLevel&&c.maxLevel==l.maxLevel){r.splice(u,1);break}}--a.cnt||(i.$src.removeChild(a.el),i.sources.delete(o),i.handleOverflow(),--i.sLen||_t(i.$here,!0))}},t}(jt);Zt.prototype.listeners={".btn":{click:function(t){var e="+"==this.$btn.innerText;this.showDetails(e)}}},Zt.prototype.style={".copyright *":"        color: #fff;        font-family: arial;        opacity: 0.8;        text-decoration: none;",".copyright":"        right: 0px;        bottom: 0px;        padding: 1px 4px;        margin: 0px;        background-color: rgba(0,0,0,.1);        position: absolute;        font-size: 11px;        line-height: 13px;        overflow: hidden;        white-space: nowrap;        user-select: none;",".sources":"        width:auto;        max-width: 384px;        float: left;        white-space: nowrap;        overflow: hidden;        text-overflow: ellipsis;        border-right: 2px;",".btn":"        font-family: sans-serif;        font-weight: bold;        text-align: center;        height: 12px;        width: 12px;        float: left;        padding: 0px;        line-height: 9px;        margin: 1px 2px 0px;        background-color: inherit;        box-sizing: border-box;        border-radius: 3px;        border: 1px solid;",".divider, .here, .source":"        white-space: nowrap;        padding-right: 4px;"},Zt.prototype.templ='<div class="copyright">        <span style="float: left; white-space: nowrap;">            <span class="sources"></span>            <span class="here">© 2019 HERE</span>         </span>        <span class="tac" style="float: right; white-space: nowrap;">            <span class="btn">+</span>            <span class="divider" style="white-space: nowrap;">|</span>            <a target="_blank" style="white-space: nowrap;" href="https://legal.here.com/us-en/terms/serviceterms/">Terms and Conditions</a>        </span>    </div>';var Yt=function(r){function t(t,e,n){return r.call(this,t,e,n)||this}return u(t,r),t}(jt);Yt.prototype.style={".here-logo":"        position: absolute;        bottom: 4px;        left: 4px;        z-index: 1;        margin:  0px;        background-image: url(data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3OC45NCA3NS4zMSI+PGRlZnM+PHN0eWxlPi5jbHMtMXtmaWxsOm5vbmU7fS5jbHMtMntmaWxsOiNmZmY7fS5jbHMtM3tmaWxsOiM0OGRhZDA7fTwvc3R5bGU+PC9kZWZzPjx0aXRsZT5VbnRpdGxlZC0xPC90aXRsZT48cmVjdCBjbGFzcz0iY2xzLTEiIHdpZHRoPSI3OC45NCIgaGVpZ2h0PSI3NS4zMSIvPjxwYXRoIGNsYXNzPSJjbHMtMiIgZD0iTTUwLjA5LDM4LjJsMy41NC0zLjYzTDQ5LjgsMzAuNjZjLTMuMTEtMy4xOS0yLjItNC44OC0xLjQ4LTUuNjFhNS45Myw1LjkzLDAsMCwxLDEuMjMtMSw5LjA3LDkuMDcsMCwwLDAsMS43MSwyLjM3YzMuNzEsMy44Myw3Ljc2LDMuMywxMC44Ny4wOWExMS42NywxMS42NywwLDAsMCwzLTQuNTNMNjIsMjAuMjVhMTIuNzQsMTIuNzQsMCwwLDEtMi4xOSwzLjIyYy0xLjY4LDEuNzUtMy4yOSwxLjc1LTQuMzcuODVsNi4zNy02LjQ5LS44LS44MmMtMy43NC0zLjg2LTcuMjItNC4wNy0xMC4zNi0uODVhNi41Miw2LjUyLDAsMCwwLTEuNDYsNy4xNmwtMi4zNC0yLjg0YTQuMjcsNC4yNywwLDAsMC0xLjA4Ljg4LDUuMjcsNS4yNywwLDAsMC0xLjIsNC41OUw0MywyNC41N2wtMy4xMSwzLjE5LDQuMjgsNC4zOWMtMy40LTIuODctNi40NS0yLjcyLTkuMjcuMTdzLTIuNjgsNi40OS0uMzEsOS40N2wtLjQtLjQxYy0yLjU0LTIuNi01LTMuMTYtNy40Mi0uNjRhNC43MSw0LjcxLDAsMCwwLTEuNTEsNC4xbC02LTYuMTEtMy40OSwzLjU3TDI3LjM5LDU0LjJoNy4wOGwtNC44OC01Yy0xLjcxLTEuNzMtMi4yMy0yLjkyLTEuMTctNCwuNzctLjgyLDEuNjYtLjc5LDIuNzQuMzJMMzcsNTEuNTZsMy41NC0zLjYzLTQuNC00LjVjMy40OCwzLDcuMjgsMi4yMiwxMC4xNi0uNzZhMTIuNTcsMTIuNTcsMCwwLDAsMi43NC0zLjg5TDQ2LDM3YTE0LjA4LDE0LjA4LDAsMCwxLTEuODgsMi42M2MtMS43MSwxLjc1LTMuMzEsMS43NS00LjM5Ljg1TDQ2LDM0Wm0tMTIuNjIuMjlhMi40NSwyLjQ1LDAsMCwxLDAtMy41MSwyLjM0LDIuMzQsMCwwLDEsMy40NSwwWk01My4yNSwyMi4zMmEyLjQ1LDIuNDUsMCwwLDEsMC0zLjUxLDIuMzEsMi4zMSwwLDAsMSwzLjQzLDBaIi8+PHBvbHlnb24gaWQ9Im9yaWciIGNsYXNzPSJjbHMtMyIgcG9pbnRzPSIxMy44MSA1NC4yIDEzLjgxIDU0LjIgMjAuOTIgNjEuNDggMjguMDIgNTQuMiAyOC4wMiA1NC4yIDEzLjgxIDU0LjIiLz48L3N2Zz4=);        background-repeat: no-repeat;        width:  38px;        height: 38px;        cursor: pointer;"},Yt.prototype.templ='<div class="here-logo"></div>';var qt,Wt,Xt={ZoomControl:Et,Copyright:Zt,HERE:Yt},Gt={Copyright:{visible:!0},ZoomControl:{visible:!0},HERE:{visible:!0}},Ut=function(){function t(t,e,n){var r=e.UI||e.ui||{},i=this.components={};for(var o in this.el=t,r=et.JSUtils.extend(!0,et.JSUtils.clone(Gt),r)){var a=r[o];a.visible&&Xt[o]&&(i[o]=new Xt[o](t,a,n,e))}}return t.prototype.destroy=function(){var t=this.el,e=this.components;for(var n in e)e[n].disable();t.parentNode.removeChild(t)},t}(),Vt=et.JSUtils.isFunction,Ft=function(){function t(t,e){this.startTs=0;var n=this;n.map=t,Vt(e.onStart)&&(n.onStart=e.onStart),Vt(e.onStop)&&(n.onStop=e.onStop),n._animate=n._animate.bind(n)}return t.prototype.zoom=function(){var t=this,e=+new Date-t.startTs,n=e/t.duration,r=n%1;if(1<=n&&(r=1),t.map.setZoomlevel(t.zoomStart+r*t.zoomDelta,t.zoomX,t.zoomY),e<t.duration)return!0;t.startTs=0,t.onStop()},t.prototype._animate=function(){this.zoom()&&requestAnimationFrame(this._animate)},t.prototype.onStart=function(){},t.prototype.onStop=function(){},t.prototype.animate=function(t,e,n,r){var i=this;i.startTs||(i.onStart(),i.startTs=Date.now(),i.zoomX=e,i.zoomY=n,i.zoomStart=i.map.getZoomlevel(),i.duration=r,i.zoomDelta=t-i.zoomStart,requestAnimationFrame(i._animate))},t}(),Qt=function(t,e,n,r){return n*Math.sin(t/r*(Math.PI/2))+e},Ht=et.JSUtils.isFunction,Jt=function(){function t(t,e){e=e||{};var n=this;n.map=t,n.duration=e.duration||500,Ht(e.onStart)&&(n.onStart=e.onStart),Ht(e.onStop)&&(n.onStop=e.onStop),n.raf=function(){n._pan()&&(n.rafId=requestAnimationFrame(n.raf))}}return t.prototype._pan=function(){var t=this,e=t.deltaX,n=t.deltaY,r=t.duration,i=t.startTs,o=Date.now()-i;r<o&&(o=r);var a=Qt(o,0,e,r),s=Qt(o,0,n,r);if(t.map.pan(a-t.lastDx||0,s-t.lastDy||0),a!=e||s!=n)return t.lastDx=a,t.lastDy=s,!0;t.onStop()},t.prototype.pan=function(t,e,n){this.startTs=t,this.deltaX=e,this.deltaY=n,this.onStart(),this.raf()},t.prototype.cancel=function(){var t=this.rafId;t&&(cancelAnimationFrame(t),this.rafId=null),this.onStop(),this.startTs=0,this.lastDx=0,this.lastDy=0},t.prototype.onStart=function(){},t.prototype.onStop=function(){},t}(),$t=function(t,e){for(var n=0,r=[t,e];n<r.length;n++)for(var i=r[n],o=0;o<i.length;o++){for(var a=qt,s=qt,l=qt,u=qt,c=void 0,h=(o+1)%i.length,p=i[o],f=i[h],d=[f[1]-p[1],p[0]-f[0]],y=0,v=t;y<v.length;y++){var g=v[y];c=d[0]*g[0]+d[1]*g[1],(a===qt||c<a)&&(a=c),(s===qt||s<c)&&(s=c)}for(var m=0,x=e;m<x.length;m++){g=x[m];c=d[0]*g[0]+d[1]*g[1],(l===qt||c<l)&&(l=c),(u===qt||u<c)&&(u=c)}if(s<l||u<a)return!1}return!0},Kt=function(t,e,n,r,i){var o=Math.sin(i),a=Math.cos(i),s=t-n,l=e-r;return[a*s-o*l+n,o*s+a*l+r]},te=e.tile.Utils,ee=e.projection.webMercator,ne=function(){function t(t){this.size=t}return t.prototype.init=function(t,r,e,n){for(var i=t.minLon,o=t.maxLon,a=t.minLat,s=t.maxLat,l=i+.5*(o-i),u=a+.5*(s-a),c=ee.lon2x(l,1),h=ee.lat2y(u,1),p=1/0,f=1/0,d=-1/0,y=-1/0,v=function(t,e){var n=Kt(ee.lon2x(t,1),ee.lat2y(e,1),c,h,r);return[ee.x2lon(n[0],1),ee.y2lat(n[1],1)]},g=0,m=[v(i,s),v(o,s),v(i,a),v(o,a)];g<m.length;g++){var x=m[g];x[0]<p&&(p=x[0]),x[0]>d&&(d=x[0]),x[1]<f&&(f=x[1]),x[1]>y&&(y=x[1])}this.minLon=p,this.maxLon=d,this.minLat=f,this.maxLat=y,this.boundsMinLon=i,this.boundsMaxLat=s},t.prototype.getGrid=function(t,e){void 0===e&&(e=this.size);for(var n=[],r=this.minLon,i=this.maxLon,o=this.minLat,a=this.maxLat,s=this.boundsMinLon,l=this.boundsMaxLat,u=e<<t,c=te.geoToGrid(r,a,t),h=te.geoToGrid(i,o,t),p=h[2]-c[2]+1,f=h[1]-c[1]+1,d=c[2]*e,y=c[1]*e,v=ee.lon2x(s,u),g=ee.lat2y(l,u),m=te.getTilesIds(c,h),x=0,w=0;x<f;x++){n[x]=[];for(var L=0;L<p;L++)n[x][L]=m[w++]}return this.x=d-v,this.y=y-g,n},t}(),re={ui:{},zoomLevel:18,center:{longitude:8.534,latitude:50.162},layers:null,credentials:null,maxLevel:20,minLevel:2,debug:!1,minPanMapThreshold:4,zoomAnimationMs:100},ie=e.projection.webMercator,oe=e.geo.Rect,ae=e.geo.Point,se=e.pixel.Point,le=e.layers.TileLayer,ue=85.05112878,ce=-ue,he="longitude",pe="latitude",fe="zoom",de="drag",ye="addLayer",ve="removeLayer";function ge(n,g){g=et.JSUtils.extend(et.JSUtils.extend(!0,{},re),g||{});var S,C,m=this,k=0,D=0,N=nt(n,"width"),I=nt(n,"height"),j=N,E=I,x=j/2,w=E/2,P=0,l=0,A=g.zoomlevel||g.zoomLevel,O=256<<A,r=new et.Listener("center","rotation","zoomlevel","mapviewchangestart","mapviewchange","mapviewchangeend","resize",ye,ve),R=[],B={},_={},Z={},Y={},L=1,q=0,W=0,X=0;m.layers=R,m.id=1e6*Math.random()^0;var t=n;(n=document.createElement("div")).className="_"+et.JSUtils.String.random(11),n.style["-webkit-tap-highlight-color"]="rgba(0,0,0,0)",n.style.position="relative",n.style.width=N+"px",n.style.height=I+"px",t.appendChild(n);var G=new ne(256);function o(t,e,n){r.trigger(t,[new yt(t,e)],n)}function U(t,e,n){r.trigger(t,[t,e,n],!0)}m.setBackgroundColor=function(t){H.setBGColor&&H.setBGColor(t)},m.addEventListener=function(t,e){t.split(" ").forEach(function(t){if(r.isDefined(t))return r.add(t,e);u.addEventListener(t,e)})},m.removeEventListener=function(t,e){t.split(" ").forEach(function(t){if(r.isDefined(t))return r.remove(t,e);u.removeEventListener(t,e)})};var V=1,F={};function Q(t,e){t.loadStartTs&&(t.isLoaded()||e.cancelTile(t,K[e.id]))}function M(){G.init(function(){var t=(j+k)/2,e=(E+D)/2;S=_.x-t/V,C=_.y-e/V;var n=ie.x2lon(S,O),r=ie.y2lat(C,O),i=_.x+t/V,o=_.y+e/V,a=ie.x2lon(i,O),s=ie.y2lat(o,O);return B=new oe(n,s,a,r),q=_.x-t-S,W=_.y-e-C,B}(),P,j,E);var t=G.getGrid(A,1),e=256*G.x-q,n=256*G.y-W;J.watch(!0),H.setTransform(V,P,X);var r,i,o,a,s=[H.unproject(0,0),H.unproject(N-1,0),H.unproject(N-1,I-1),H.unproject(0,I-1)],l=[],u=R.length;for(r=0;r<u;r++)l[r]=$[R[r].id],$[R[r].id]={};var c=[[],[],[],[]];F={};for(var h=[],p=0,f=t.length;p<f;p++)for(var d=0,y=t[p].length;d<y;d++){var v=256*d+e,g=256*p+n,m=v+256,x=g+256,w=t[p][d];c[0][0]=v,c[0][1]=g,c[1][0]=m,c[1][1]=g,c[2][0]=m,c[2][1]=x,c[3][0]=v,c[3][1]=x,v=Math.round(v),g=Math.round(g),F[w]=[v,g],$t(s,c)&&(h[h.length]=[w,v,g])}H.initViewport(h,B,A);for(var L=0,M=h.length;L<M;L++){var b,T=h[L][0];for(r=0;r<u;r++)b=(i=R[r]).id,A>=i.min&&A<=i.max&&($[b][T]=i.getTile(T,K[b]))}for(var z in l[0])if(!$[R[0].id][z]){for(r=0;r<u;r++)(o=l[r][z])&&(a=o,tt&&a.z==A||Q(a,R[r]));H.cancel(z)}H.update(),(Y[he]!=Z[he]||Y[pe]!=Z[pe])&&(U("center",Z,Y),Y=Z)}var i=0,a=0;m.getWidth=function(){return j-i},m.getHeight=function(){return E-a},m.getViewBounds=function(){var t=B.minLon,e=B.maxLon,n=B.minLat,r=B.maxLat;return n<=ce&&(n=-90),ue<=r&&(r=90),t<-180&&(t=-180),180<e&&(e=180),new oe(t,n,e,r)},m.setViewBounds=function(t){var e,n,r,i,o,a,s=arguments;i=4==s.length?(e=s[0],n=s[1],r=s[2],s[3]):(t.bbox&&(t=t.bbox),t instanceof Array?(e=t[0],n=t[1],r=t[2],t[3]):(e=t.minLon,n=t.minLat,r=t.maxLon,t.maxLat)),o=r-e,a=i-n,m.setZoomlevel(function(t,e,n,r,i,o){for(var a,s,l,u=256<<20,c=20;0<=c;--c)if(l=20-c,a=(ie.lon2x(n,u)>>l)-(ie.lon2x(t,u)>>l),s=(ie.lat2y(e,u)>>l)-(ie.lat2y(r,u)>>l),a<=i&&s<=o)return c;return 0}(e,n,r,i,m.getWidth(),m.getHeight())),m.setCenter(e+o/2,n+a/2)};var H=new(g.Renderer||ht)(n,256,g.devicePixelRatio),J=new It(m,o,H);m._display=H;var c=new Mt(m);m.getFeatureAt=function(t,e){(e=e||{}).topOnly=!0;var n=m.getFeaturesAt(t,e);if(n.length)return(n=n[n.length-1]).feature=n.features[0],n},m.getFeaturesAt=function(t,e){var n,r,i,o;if(e=e||{},t.x!=Wt&&t.y!=Wt){var a=t.x,s=t.y,l=0^e.width,u=e.height||l;n=a-l/2,r=a+l/2,i=s-u/2,o=s+u/2}else t.minX!=Wt&&t.maxX!=Wt&&(n=t.minX,i=t.minY,r=t.maxX,o=t.maxY);return n!=Wt&&c.search(n,i,r,o,e.layers,e.topOnly)};var $={},K={};function s(e,t){var n=e.id;$[n]||($[n]={},K[n]=function(t){F[t.quadkey]&&H.handleTile(t,e)},H.addLayer(e,e.getStyle(),t),e.addEventListener("clear",m.refresh),o(ye,{index:t,layer:e}))}var u=new mt(n,m,R,g),tt=!1,e=!1,b=new Ft(m,{onStart:function(){tt=!0,u.disable("pointerenter")},onStop:function(){tt=!1,e||u.enable("pointerenter")}}),h={zoom:!0,drag:!0},p=new pt(n,m,new Jt(m,{onStart:function(){e=!0,u.disable("pointerenter")},onStop:function(){e=!1,tt||u.enable("pointerenter")}}),h,g);function T(t){var e;return(e=t)[0]/=L,e[1]/=L,t[0]=S+(k+i)/2+t[0],t[1]=C+(D+a)/2+t[1],t}p.drag(!0),p.scroll(!0),m.getBehavior=function(){return et.JSUtils.clone(h)},m.setBehavior=function(t,e){var n=typeof t,r="object"==n?t:{};"string"==n&&(r[t]=e),r[fe]!=Wt&&(h[fe]=!!r[fe]),r[de]!=Wt&&(h[de]=!!r[de])},m.getZoomlevel=function(){return A+L%1};function z(t,e){return 2!=arguments.length&&(t=t instanceof Array?(e=t[1],t[0]):(e=(t=t||Z)[pe],t[he])),!isNaN(t)&&!isNaN(e)&&"number"==typeof t&&"number"==typeof e&&(180<t?t-=360:t<-180&&(t+=360),e<ce?e=ce:ue<e&&(e=ue),(Z={})[he]=t,Z[pe]=e,_=new se(ie.lon2x(t,O),ie.lat2y(e,O)),!0)}m.setZoomlevel=function(t,e,n,r){if(t=Math.round(1e3*t)/1e3,2==arguments.length&&(r=e,e=Wt),e!=Wt&&n!=Wt||(e=x,n=w),t>g.maxLevel&&(t=g.maxLevel),r)b.animate(t,e,n,"number"==typeof r?r:250);else if(t<=g.maxLevel&&t>=g.minLevel&&(A!=t||1!=L)){var i=m.getZoomlevel(),o=(0^t)-A,a=1+Math.round(t%1*1e4)/1e4;if(f=a,d=Kt(e,n,x,w,-P),y=N/2-d[0],v=I/2-d[1],T(d),V=f,z(ie.x2lon(d[0]+y/f,O),ie.y2lat(d[1]+v/f,O)),o){t^=0;var s=Kt(e||0,n||0,x,w,-P),l=A-t,u=Math.pow(.5,l);if(0!==l){T(s);var c=O;O=256<<(A=t);var h=ie.x2lon(s[0]+(_.x-s[0])/u,c),p=ie.y2lat(s[1]+(_.y-s[1])/u,c);L=a,m.setCenter(h,p)}}else L=a,M();U("zoomlevel",m.getZoomlevel(),i)}var f,d,y,v},m.getLayers=function(t){return t!=Wt?R[t]:R.slice()},m.addLayer=function(t,e){for(var n in R)if(R[n]===t)return;e==Wt&&(e=R.length),s(t,e),R.splice(e,0,t),M()},m.removeLayer=function(t){for(var e=0;e<R.length;e++)if(R[e]==t){var n,r=t.id;for(var i in H.removeLayer(t),t.removeEventListener("clear",m.refresh),$[r])Q(n=$[r][i],t),H.cancel(n.quadkey,t);delete $[r],delete K[r],R.splice(e,1),M(),o(ve,{index:e,layer:t});break}},m.setCenter=function(){z.apply(m,arguments)&&M()},m.getCenter=function(){return new ae(Z.longitude,Z.latitude)},m.rotate3D=function(t,e,n){if(t!==Wt){var r=t%360|0;X=r*Math.PI/180,function(t,e){1==arguments.length&&(e=t);var n=j-i,r=E-a;i=(j=n*t)-n,a=(E=r*e)-r}(1-2.5*r/100),n!==Wt&&n!==P?m.rotate(n):M()}return X};var f={pan:!(m.rotate=function(t,e,n){if(t!==Wt){var r=(0|t)*Math.PI/180;if(r!==P){1===arguments.length&&(e=x,n=w);var i=x-e,o=w-n,a=Kt(i,o,0,0,-P),s=P;_.x-=a[0]/L,_.y-=a[1]/L,P=r,l=Math.round(P/Math.PI*180),m.pan(-i,-o),M(),U("rotation",P,s)}}return l}),minLevel:1,maxLevel:g.maxLevel};m.lockViewport=function(t){if(t){var e=t.pan,n=t.minLevel,r=t.maxLevel;n=!1===n?1:n,r=!1===r?g.maxLevel:r,e!=Wt&&(f.pan=e),"number"==typeof n&&(f.minLevel=n),"number"==typeof r&&(f.maxLevel=r)}return f},m.pan=function(t,e,n,r){if(e=(e^0-(0^r))/L,0!=(t=(t^0-(0^n))/L)||0!=e){var i=Kt(t,e,0,0,-P),o=_.x-i[0],a=_.y-i[1];m.setCenter(ie.x2lon(o,O),ie.y2lat(a,O))}},m.resize=function(t,e){t!=Wt&&e!=Wt||(t=nt(n.parentNode,"width"),e=nt(n.parentNode,"height")),j===t&&E===e||(n.style.width=t+"px",n.style.height=e+"px",H.setSize(t,e),x=(j=t)/2,w=(E=e)/2,N=j,I=E,M(),o("resize",{width:N,height:I}))},m.repaint=function(){M()},m.refresh=function(t){t instanceof Array||(t=[t]);for(var e=t.length;e--;)t[e]instanceof le&&H.clearLayer(t[e]);M()},m.debug=function(t){H.showGrid(t),M()},m.addObserver=function(t,e){return"zoomLevel"==t&&(t="zoomlevel"),r.add(t,e)},m.removeObserver=function(t,e){return"zoomLevel"==t&&(t="zoomlevel"),r.remove(t,e)},m.pixelToGeo=function(t,e){1==arguments.length&&(e=t.y,t=t.x);var n=H.unproject(t,e,q,W),r=n[0]+S+k/2+q,i=n[1]+C+D/2+W;return r%=O,(i%=O)<0&&(i+=O),new ae(ie.x2lon(r,O),ie.y2lat(i,O))},m.geoToPixel=function(t,e){e==Wt&&(e=t.latitude,t=t.longitude),e<ce?e=ce:ue<e&&(e=ue);var n=ie.lon2x(t,O)-S-k/2,r=ie.lat2y(e,O)-C-D/2,i=H.project(n,r,q,W);return new se(i[0],i[1])},m.getContainer=function(){return n.parentNode},m.destroy=function(){for(var t in d.destroy(),R.forEach(m.removeLayer),H.destroy(),J.watch(!1),u.destroy(),p.drag(!1),p.scroll(!1),p.resize(!1),m)delete m[t]};var d=new Ut(n,g,m);(g.layers||[]).forEach(function(t,e){s(t,e),R.push(t)}),m.setCenter(g.center)}et.global.here.xyz.maps.Map=ge,t.Map=ge,t.default=ge,Object.defineProperty(t,"__esModule",{value:!0})});
