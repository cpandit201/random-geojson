/*
 * @here/xyz-maps-plugins
 * (c) 2019 HERE
 */
/* pbf, vector-tile: Copyright (c) Mapbox */
import*as t from"@here/xyz-maps-core";import{loaders as i,providers as r,layers as e,storage as n}from"@here/xyz-maps-core";import{JSUtils as s,TaskManager as o,Queue as a,LRU as h}from"@here/xyz-maps-common";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var u=function(t,i){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var r in i)i.hasOwnProperty(r)&&(t[r]=i[r])})(t,i)};function f(t,i){function r(){this.constructor=t}u(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}var c=function(t){function i(i){var r=s.extend({Accept:"*/*"},i.headers||{});return t.call(this,{url:i.url,headers:r,responseType:"arraybuffer"})||this}return f(i,t),i}(i.HTTPLoader),p=function(t,i,r,e,n){var s,o,a=8*n-e-1,h=(1<<a)-1,u=h>>1,f=-7,c=r?n-1:0,p=r?-1:1,l=t[i+c];for(c+=p,s=l&(1<<-f)-1,l>>=-f,f+=a;f>0;s=256*s+t[i+c],c+=p,f-=8);for(o=s&(1<<-f)-1,s>>=-f,f+=e;f>0;o=256*o+t[i+c],c+=p,f-=8);if(0===s)s=1-u;else{if(s===h)return o?NaN:1/0*(l?-1:1);o+=Math.pow(2,e),s-=u}return(l?-1:1)*o*Math.pow(2,s-e)},l=function(t,i,r,e,n,s){var o,a,h,u=8*s-n-1,f=(1<<u)-1,c=f>>1,p=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,l=e?0:s-1,d=e?1:-1,y=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(a=isNaN(i)?1:0,o=f):(o=Math.floor(Math.log(i)/Math.LN2),i*(h=Math.pow(2,-o))<1&&(o--,h*=2),(i+=o+c>=1?p/h:p*Math.pow(2,1-c))*h>=2&&(o++,h/=2),o+c>=f?(a=0,o=f):o+c>=1?(a=(i*h-1)*Math.pow(2,n),o+=c):(a=i*Math.pow(2,c-1)*Math.pow(2,n),o=0));n>=8;t[r+l]=255&a,l+=d,a/=256,n-=8);for(o=o<<n|a,u+=n;u>0;t[r+l]=255&o,l+=d,o/=256,u-=8);t[r+l-d]|=128*y},d=y;function y(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}y.Varint=0,y.Fixed64=1,y.Bytes=2,y.Fixed32=5;function w(t){return t.type===y.Bytes?t.readVarint()+t.pos:t.pos+1}function v(t,i,r){return r?4294967296*i+(t>>>0):4294967296*(i>>>0)+(t>>>0)}function x(t,i,r){var e=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.ceil(Math.log(i)/(7*Math.LN2));r.realloc(e);for(var n=r.pos-1;n>=t;n--)r.buf[n+e]=r.buf[n]}function g(t,i){for(var r=0;r<t.length;r++)i.writeVarint(t[r])}function b(t,i){for(var r=0;r<t.length;r++)i.writeSVarint(t[r])}function F(t,i){for(var r=0;r<t.length;r++)i.writeFloat(t[r])}function m(t,i){for(var r=0;r<t.length;r++)i.writeDouble(t[r])}function V(t,i){for(var r=0;r<t.length;r++)i.writeBoolean(t[r])}function M(t,i){for(var r=0;r<t.length;r++)i.writeFixed32(t[r])}function _(t,i){for(var r=0;r<t.length;r++)i.writeSFixed32(t[r])}function S(t,i){for(var r=0;r<t.length;r++)i.writeFixed64(t[r])}function k(t,i){for(var r=0;r<t.length;r++)i.writeSFixed64(t[r])}function P(t,i){return(t[i]|t[i+1]<<8|t[i+2]<<16)+16777216*t[i+3]}function B(t,i,r){t[r]=i,t[r+1]=i>>>8,t[r+2]=i>>>16,t[r+3]=i>>>24}function T(t,i){return(t[i]|t[i+1]<<8|t[i+2]<<16)+(t[i+3]<<24)}y.prototype={destroy:function(){this.buf=null},readFields:function(t,i,r){for(r=r||this.length;this.pos<r;){var e=this.readVarint(),n=e>>3,s=this.pos;this.type=7&e,t(n,i,this),this.pos===s&&this.skip(e)}return i},readMessage:function(t,i){return this.readFields(t,i,this.readVarint()+this.pos)},readFixed32:function(){var t=P(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=T(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=P(this.buf,this.pos)+4294967296*P(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=P(this.buf,this.pos)+4294967296*T(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=p(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=p(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var i,r,e=this.buf;return i=127&(r=e[this.pos++]),r<128?i:(i|=(127&(r=e[this.pos++]))<<7,r<128?i:(i|=(127&(r=e[this.pos++]))<<14,r<128?i:(i|=(127&(r=e[this.pos++]))<<21,r<128?i:function(t,i,r){var e,n,s=r.buf;if(n=s[r.pos++],e=(112&n)>>4,n<128)return v(t,e,i);if(n=s[r.pos++],e|=(127&n)<<3,n<128)return v(t,e,i);if(n=s[r.pos++],e|=(127&n)<<10,n<128)return v(t,e,i);if(n=s[r.pos++],e|=(127&n)<<17,n<128)return v(t,e,i);if(n=s[r.pos++],e|=(127&n)<<24,n<128)return v(t,e,i);if(n=s[r.pos++],e|=(1&n)<<31,n<128)return v(t,e,i);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(r=e[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,i=function(t,i,r){var e="",n=i;for(;n<r;){var s,o,a,h=t[n],u=null,f=h>239?4:h>223?3:h>191?2:1;if(n+f>r)break;1===f?h<128&&(u=h):2===f?128==(192&(s=t[n+1]))&&(u=(31&h)<<6|63&s)<=127&&(u=null):3===f?(s=t[n+1],o=t[n+2],128==(192&s)&&128==(192&o)&&((u=(15&h)<<12|(63&s)<<6|63&o)<=2047||u>=55296&&u<=57343)&&(u=null)):4===f&&(s=t[n+1],o=t[n+2],a=t[n+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&((u=(15&h)<<18|(63&s)<<12|(63&o)<<6|63&a)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,f=1):u>65535&&(u-=65536,e+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),e+=String.fromCharCode(u),n+=f}return e}(this.buf,this.pos,t);return this.pos=t,i},readBytes:function(){var t=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,t);return this.pos=t,i},readPackedVarint:function(t,i){var r=w(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(i));return t},readPackedSVarint:function(t){var i=w(this);for(t=t||[];this.pos<i;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var i=w(this);for(t=t||[];this.pos<i;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var i=w(this);for(t=t||[];this.pos<i;)t.push(this.readFloat());return t},readPackedDouble:function(t){var i=w(this);for(t=t||[];this.pos<i;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var i=w(this);for(t=t||[];this.pos<i;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var i=w(this);for(t=t||[];this.pos<i;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var i=w(this);for(t=t||[];this.pos<i;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var i=w(this);for(t=t||[];this.pos<i;)t.push(this.readSFixed64());return t},skip:function(t){var i=7&t;if(i===y.Varint)for(;this.buf[this.pos++]>127;);else if(i===y.Bytes)this.pos=this.readVarint()+this.pos;else if(i===y.Fixed32)this.pos+=4;else{if(i!==y.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(t,i){this.writeVarint(t<<3|i)},realloc:function(t){for(var i=this.length||16;i<this.pos+t;)i*=2;if(i!==this.length){var r=new Uint8Array(i);r.set(this.buf),this.buf=r,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),B(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),B(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),B(this.buf,-1&t,this.pos),B(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),B(this.buf,-1&t,this.pos),B(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,i){var r,e;t>=0?(r=t%4294967296|0,e=t/4294967296|0):(e=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,e=e+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(t,i,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos]=127&t}(r,0,i),function(t,i){var r=(7&t)<<4;if(i.buf[i.pos++]|=r|((t>>>=3)?128:0),!t)return;if(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),!t)return;i.buf[i.pos++]=127&t}(e,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var i=this.pos;this.pos=function(t,i,r){for(var e,n,s=0;s<i.length;s++){if((e=i.charCodeAt(s))>55295&&e<57344){if(!n){e>56319||s+1===i.length?(t[r++]=239,t[r++]=191,t[r++]=189):n=e;continue}if(e<56320){t[r++]=239,t[r++]=191,t[r++]=189,n=e;continue}e=n-55296<<10|e-56320|65536,n=null}else n&&(t[r++]=239,t[r++]=191,t[r++]=189,n=null);e<128?t[r++]=e:(e<2048?t[r++]=e>>6|192:(e<65536?t[r++]=e>>12|224:(t[r++]=e>>18|240,t[r++]=e>>12&63|128),t[r++]=e>>6&63|128),t[r++]=63&e|128)}return r}(this.buf,t,this.pos);var r=this.pos-i;r>=128&&x(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),l(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),l(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var i=t.length;this.writeVarint(i),this.realloc(i);for(var r=0;r<i;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,i){this.pos++;var r=this.pos;t(i,this);var e=this.pos-r;e>=128&&x(r,e,this),this.pos=r-1,this.writeVarint(e),this.pos+=e},writeMessage:function(t,i,r){this.writeTag(t,y.Bytes),this.writeRawMessage(i,r)},writePackedVarint:function(t,i){this.writeMessage(t,g,i)},writePackedSVarint:function(t,i){this.writeMessage(t,b,i)},writePackedBoolean:function(t,i){this.writeMessage(t,V,i)},writePackedFloat:function(t,i){this.writeMessage(t,F,i)},writePackedDouble:function(t,i){this.writeMessage(t,m,i)},writePackedFixed32:function(t,i){this.writeMessage(t,M,i)},writePackedSFixed32:function(t,i){this.writeMessage(t,_,i)},writePackedFixed64:function(t,i){this.writeMessage(t,S,i)},writePackedSFixed64:function(t,i){this.writeMessage(t,k,i)},writeBytesField:function(t,i){this.writeTag(t,y.Bytes),this.writeBytes(i)},writeFixed32Field:function(t,i){this.writeTag(t,y.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(t,i){this.writeTag(t,y.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(t,i){this.writeTag(t,y.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(t,i){this.writeTag(t,y.Fixed64),this.writeSFixed64(i)},writeVarintField:function(t,i){this.writeTag(t,y.Varint),this.writeVarint(i)},writeSVarintField:function(t,i){this.writeTag(t,y.Varint),this.writeSVarint(i)},writeStringField:function(t,i){this.writeTag(t,y.Bytes),this.writeString(i)},writeFloatField:function(t,i){this.writeTag(t,y.Fixed32),this.writeFloat(i)},writeDoubleField:function(t,i){this.writeTag(t,y.Fixed64),this.writeDouble(i)},writeBooleanField:function(t,i){this.writeVarintField(t,Boolean(i))}};var z=A;function A(t,i){this.x=t,this.y=i}A.prototype={clone:function(){return new A(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,i){return this.clone()._rotateAround(t,i)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var i=t.x-this.x,r=t.y-this.y;return i*i+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,i){return Math.atan2(this.x*i-this.y*t,this.x*t+this.y*i)},_matMult:function(t){var i=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=i,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var i=Math.cos(t),r=Math.sin(t),e=i*this.x-r*this.y,n=r*this.x+i*this.y;return this.x=e,this.y=n,this},_rotateAround:function(t,i){var r=Math.cos(t),e=Math.sin(t),n=i.x+r*(this.x-i.x)-e*(this.y-i.y),s=i.y+e*(this.x-i.x)+r*(this.y-i.y);return this.x=n,this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},A.convert=function(t){return t instanceof A?t:Array.isArray(t)?new A(t[0],t[1]):t};var L=N;function N(t,i,r,e,n){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=e,this._values=n,t.readFields(I,this,i)}function I(t,i,r){1==t?i.id=r.readVarint():2==t?function(t,i){var r=t.readVarint()+t.pos;for(;t.pos<r;){var e=i._keys[t.readVarint()],n=i._values[t.readVarint()];i.properties[e]=n}}(r,i):3==t?i.type=r.readVarint():4==t&&(i._geometry=r.pos)}function C(t){for(var i,r,e=0,n=0,s=t.length,o=s-1;n<s;o=n++)i=t[n],e+=((r=t[o]).x-i.x)*(i.y+r.y);return e}N.types=["Unknown","Point","LineString","Polygon"],N.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var i,r=t.readVarint()+t.pos,e=1,n=0,s=0,o=0,a=[];t.pos<r;){if(n<=0){var h=t.readVarint();e=7&h,n=h>>3}if(n--,1===e||2===e)s+=t.readSVarint(),o+=t.readSVarint(),1===e&&(i&&a.push(i),i=[]),i.push(new z(s,o));else{if(7!==e)throw new Error("unknown command "+e);i&&i.push(i[0].clone())}}return i&&a.push(i),a},N.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var i=t.readVarint()+t.pos,r=1,e=0,n=0,s=0,o=1/0,a=-1/0,h=1/0,u=-1/0;t.pos<i;){if(e<=0){var f=t.readVarint();r=7&f,e=f>>3}if(e--,1===r||2===r)(n+=t.readSVarint())<o&&(o=n),n>a&&(a=n),(s+=t.readSVarint())<h&&(h=s),s>u&&(u=s);else if(7!==r)throw new Error("unknown command "+r)}return[o,h,a,u]},N.prototype.toGeoJSON=function(t,i,r){var e,n,s=this.extent*Math.pow(2,r),o=this.extent*t,a=this.extent*i,h=this.loadGeometry(),u=N.types[this.type];function f(t){for(var i=0;i<t.length;i++){var r=t[i],e=180-360*(r.y+a)/s;t[i]=[360*(r.x+o)/s-180,360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90]}}switch(this.type){case 1:var c=[];for(e=0;e<h.length;e++)c[e]=h[e][0];f(h=c);break;case 2:for(e=0;e<h.length;e++)f(h[e]);break;case 3:for(h=function(t){var i=t.length;if(i<=1)return[t];for(var r,e,n=[],s=0;s<i;s++){var o=C(t[s]);0!==o&&(void 0===e&&(e=o<0),e===o<0?(r&&n.push(r),r=[t[s]]):r.push(t[s]))}r&&n.push(r);return n}(h),e=0;e<h.length;e++)for(n=0;n<h[e].length;n++)f(h[e][n])}1===h.length?h=h[0]:u="Multi"+u;var p={type:"Feature",geometry:{type:u,coordinates:h},properties:this.properties};return"id"in this&&(p.id=this.id),p};var D=E;function E(t,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(O,this,i),this.length=this._features.length}function O(t,i,r){15===t?i.version=r.readVarint():1===t?i.name=r.readString():5===t?i.extent=r.readVarint():2===t?i._features.push(r.pos):3===t?i._keys.push(r.readString()):4===t&&i._values.push(function(t){var i=null,r=t.readVarint()+t.pos;for(;t.pos<r;){var e=t.readVarint()>>3;i=1===e?t.readString():2===e?t.readFloat():3===e?t.readDouble():4===e?t.readVarint64():5===e?t.readVarint():6===e?t.readSVarint():7===e?t.readBoolean():null}return i}(r))}function j(t,i,r){if(3===t){var e=new D(r,r.readVarint()+r.pos);e.length&&(i[e.name]=e)}}E.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var i=this._pbf.readVarint()+this._pbf.pos;return new L(this._pbf,i,this.extent,this._keys,this._values)};var G={VectorTile:function(t,i){this.layers=t.readFields(j,{},i)},VectorTileFeature:L,VectorTileLayer:D},U=G.VectorTile,W=G.VectorTileFeature,q=o.getInstance(),R=16,Z=0;function H(t){for(var i,r,e=0,n=0,s=t.length,o=s-1;n<s;o=n++)i=t[n],e+=((r=t[o]).x-i.x)*(i.y+r.y);return e}function J(t,i,r,e,n){var s,o,a=t.extent*Math.pow(2,e),h=t.extent*i,u=t.extent*r,f=t.loadGeometry(),c=W.types[t.type],p=1/0,l=-p,d=p,y=-d;function w(t){for(var i=0;i<t.length;i++){var r=t[i],e=180-360*(r.y+u)/a,s=360*(r.x+h)/a-180,o=360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90;n&&(s<p&&(p=s),s>l&&(l=s),o<d&&(d=o),o>y&&(y=o)),t[i]=[s,o]}}switch(t.type){case 1:var v=[];for(s=0;s<f.length;s++)v[s]=f[s][0];w(f=v);break;case 2:for(s=0;s<f.length;s++)w(f[s]);break;case 3:for(f=function(t){var i=t.length;if(i<=1)return[t];for(var r,e,n=[],s=0;s<i;s++){var o=H(t[s]);0!==o&&(void 0===e&&(e=o<0),e===o<0?(r&&n.push(r),r=[t[s]]):r.push(t[s]))}return r&&n.push(r),n}(f),s=0;s<f.length;s++)for(o=0;o<f[s].length;o++)w(f[s][o])}1===f.length?f=f[0]:c="Multi"+c;var x={type:"Feature",geometry:{type:c,coordinates:f},properties:t.properties};return"id"in t&&(x.id=t.id),n&&(x.bbox=[p,d,l,y]),x}function K(t){q.create({init:function(){var i=new U(new d(t.data)),r=[];for(var e in i.layers)r.push(e);return{x:t.x,y:t.y,z:t.z,vt:i,layers:r,l:0,f:0,geojson:[]}},priority:4,exec:function(t){for(var i,r,e=t.vt,n=t.layers,s=t.l,o=t.f,a=t.geojson,h=t.x,u=t.y,f=t.z;s<n.length;){for(i=e.layers[n[s]];o<i.length;)if((r=J(i.feature(o++),h,u,f,!0)).id=++Z,r.properties.layer=i.name,a.push(r),!(o%R))return t.f=o,this.CONTINUE;return t.l=++s,t.f=0,this.CONTINUE}return this.BREAK},onDone:function(i){t.ready(i.geojson)}}).start()}var Q=function(t){function i(i){var r=t.call(this,s.extend({loader:i.loader||new c(i),margin:0,staticData:!0},i),K)||this;return r.c=null,r}return f(i,t),i.prototype.getCopyright=function(t){var i=this,r=i.url.match(/.*xyz+.*here\.com\/tiles\/[a-zA-Z]+[\.\d]*\//),e=i.c;t&&(null==e?r?((e=new a).add(t),i.c=e,i.getLoader().src[0].send({url:r+"copyright",responseType:"json",success:function(t){i.c=t,e.done(t)}})):t(i.c=[]):e instanceof a?e.add(t):t(e))},i}(r.RemoteTileProvider),X={backgroundColor:"#555555",strokeWidthZoomScale:function(t){return t>17?1:t>14?.5:.25},styleGroups:{earth:[{zIndex:1,type:"Polygon",fill:"#555555"}],water:[{zIndex:2,type:"Polygon",fill:"#353535"}],landuse:[{zIndex:3,type:"Polygon",fill:"#666666"}],roads:[{zIndex:4,type:"Line",stroke:"#ffffff",strokeWidth:4}],roadshighway:[{zIndex:5,type:"Line",stroke:"#ffffff",strokeWidth:6}],buildings:[{zIndex:7,type:"Polygon",fill:"#999999"}]},assign:function(t,i){var r=t.properties,e=r.kind,n=r.layer,s=t.geometry.type;if("water"!=n||"LineString"!=s&&"MultiLineString"!=s){if("roads"==n){if("rail"==e||"ferry"==e)return;if("highway"==e)return n+e}return n}}},Y=e.TileLayer,$=n.Level2Storage,tt=512,it=function(t){function i(i){var r,e=i.remote,n=e.url,s=e.min||2,o=e.max||16,a=e.tileSize,u=i.name||"",f=i.max||20,p=new c(e),l=[];a||(a=(a=n.match(/256|512|1024|2048|4096/))?Number(a[0]):tt),r=Math.round(Math.log(a)/Math.log(2)-8);for(var d=new h(256/Math.pow(2,r)),y=new h(4*d.max),w=s;w<=o;w++)l.push({min:w,max:w==o?f:w,provider:new Q({name:u+"-L"+w,url:n,level:w-r,loader:p,storage:new $(w-r,d,y)})});return t.call(this,{name:i.name,providers:l,min:i.min||s,max:f,margin:0,style:i.style||X})||this}return f(i,t),i.prototype.getCopyright=function(t){this.getProvider(this.max).getCopyright(t)},i}(Y);r.MVTProvider=Q,e.MVTLayer=it;export default t;
