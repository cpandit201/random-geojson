/*
 * @here/xyz-maps-plugins
 * (c) 2019 HERE
 */
/* pbf, vector-tile: Copyright (c) Mapbox */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i(require("@here/xyz-maps-core"),require("@here/xyz-maps-common")):"function"==typeof define&&define.amd?define(["@here/xyz-maps-core","@here/xyz-maps-common"],i):((t=t||self).here=t.here||{},t.here.xyz=t.here.xyz||{},t.here.xyz.maps=i(t.here.xyz.maps,t.here.xyz.maps.common))}(this,function(t,y){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
var r=function(t,i){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(t,i)};function i(t,i){function e(){this.constructor=t}r(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}var w=function(e){function t(t){var i=y.JSUtils.extend({Accept:"*/*"},t.headers||{});return e.call(this,{url:t.url,headers:i,responseType:"arraybuffer"})||this}return i(t,e),t}(t.loaders.HTTPLoader),e=function(t,i,e,r,n){var s,o,a=8*n-r-1,h=(1<<a)-1,u=h>>1,f=-7,c=e?n-1:0,p=e?-1:1,l=t[i+c];for(c+=p,s=l&(1<<-f)-1,l>>=-f,f+=a;0<f;s=256*s+t[i+c],c+=p,f-=8);for(o=s&(1<<-f)-1,s>>=-f,f+=r;0<f;o=256*o+t[i+c],c+=p,f-=8);if(0===s)s=1-u;else{if(s===h)return o?NaN:1/0*(l?-1:1);o+=Math.pow(2,r),s-=u}return(l?-1:1)*o*Math.pow(2,s-r)},n=function(t,i,e,r,n,s){var o,a,h,u=8*s-n-1,f=(1<<u)-1,c=f>>1,p=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,l=r?0:s-1,d=r?1:-1,y=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(a=isNaN(i)?1:0,o=f):(o=Math.floor(Math.log(i)/Math.LN2),i*(h=Math.pow(2,-o))<1&&(o--,h*=2),2<=(i+=1<=o+c?p/h:p*Math.pow(2,1-c))*h&&(o++,h/=2),f<=o+c?(a=0,o=f):1<=o+c?(a=(i*h-1)*Math.pow(2,n),o+=c):(a=i*Math.pow(2,c-1)*Math.pow(2,n),o=0));8<=n;t[e+l]=255&a,l+=d,a/=256,n-=8);for(o=o<<n|a,u+=n;0<u;t[e+l]=255&o,l+=d,o/=256,u-=8);t[e+l-d]|=128*y},s=o;function o(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}o.Varint=0,o.Fixed64=1,o.Bytes=2,o.Fixed32=5;var a=4294967296,h=1/a;function u(t){return t.type===o.Bytes?t.readVarint()+t.pos:t.pos+1}function f(t,i,e){return e?4294967296*i+(t>>>0):4294967296*(i>>>0)+(t>>>0)}function c(t,i,e){var r=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.ceil(Math.log(i)/(7*Math.LN2));e.realloc(r);for(var n=e.pos-1;t<=n;n--)e.buf[n+r]=e.buf[n]}function p(t,i){for(var e=0;e<t.length;e++)i.writeVarint(t[e])}function l(t,i){for(var e=0;e<t.length;e++)i.writeSVarint(t[e])}function d(t,i){for(var e=0;e<t.length;e++)i.writeFloat(t[e])}function x(t,i){for(var e=0;e<t.length;e++)i.writeDouble(t[e])}function v(t,i){for(var e=0;e<t.length;e++)i.writeBoolean(t[e])}function g(t,i){for(var e=0;e<t.length;e++)i.writeFixed32(t[e])}function b(t,i){for(var e=0;e<t.length;e++)i.writeSFixed32(t[e])}function m(t,i){for(var e=0;e<t.length;e++)i.writeFixed64(t[e])}function F(t,i){for(var e=0;e<t.length;e++)i.writeSFixed64(t[e])}function V(t,i){return(t[i]|t[i+1]<<8|t[i+2]<<16)+16777216*t[i+3]}function M(t,i,e){t[e]=i,t[e+1]=i>>>8,t[e+2]=i>>>16,t[e+3]=i>>>24}function _(t,i){return(t[i]|t[i+1]<<8|t[i+2]<<16)+(t[i+3]<<24)}o.prototype={destroy:function(){this.buf=null},readFields:function(t,i,e){for(e=e||this.length;this.pos<e;){var r=this.readVarint(),n=r>>3,s=this.pos;this.type=7&r,t(n,i,this),this.pos===s&&this.skip(r)}return i},readMessage:function(t,i){return this.readFields(t,i,this.readVarint()+this.pos)},readFixed32:function(){var t=V(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=_(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=V(this.buf,this.pos)+V(this.buf,this.pos+4)*a;return this.pos+=8,t},readSFixed64:function(){var t=V(this.buf,this.pos)+_(this.buf,this.pos+4)*a;return this.pos+=8,t},readFloat:function(){var t=e(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=e(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var i,e,r=this.buf;return i=127&(e=r[this.pos++]),e<128?i:(i|=(127&(e=r[this.pos++]))<<7,e<128?i:(i|=(127&(e=r[this.pos++]))<<14,e<128?i:(i|=(127&(e=r[this.pos++]))<<21,e<128?i:function(t,i,e){var r,n,s=e.buf;if(n=s[e.pos++],r=(112&n)>>4,n<128)return f(t,r,i);if(n=s[e.pos++],r|=(127&n)<<3,n<128)return f(t,r,i);if(n=s[e.pos++],r|=(127&n)<<10,n<128)return f(t,r,i);if(n=s[e.pos++],r|=(127&n)<<17,n<128)return f(t,r,i);if(n=s[e.pos++],r|=(127&n)<<24,n<128)return f(t,r,i);if(n=s[e.pos++],r|=(1&n)<<31,n<128)return f(t,r,i);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(e=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,i=function(t,i,e){var r="",n=i;for(;n<e;){var s,o,a,h=t[n],u=null,f=239<h?4:223<h?3:191<h?2:1;if(e<n+f)break;1===f?h<128&&(u=h):2===f?128==(192&(s=t[n+1]))&&(u=(31&h)<<6|63&s)<=127&&(u=null):3===f?(s=t[n+1],o=t[n+2],128==(192&s)&&128==(192&o)&&((u=(15&h)<<12|(63&s)<<6|63&o)<=2047||55296<=u&&u<=57343)&&(u=null)):4===f&&(s=t[n+1],o=t[n+2],a=t[n+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&((u=(15&h)<<18|(63&s)<<12|(63&o)<<6|63&a)<=65535||1114112<=u)&&(u=null)),null===u?(u=65533,f=1):65535<u&&(u-=65536,r+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),r+=String.fromCharCode(u),n+=f}return r}(this.buf,this.pos,t);return this.pos=t,i},readBytes:function(){var t=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,t);return this.pos=t,i},readPackedVarint:function(t,i){var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readVarint(i));return t},readPackedSVarint:function(t){var i=u(this);for(t=t||[];this.pos<i;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var i=u(this);for(t=t||[];this.pos<i;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var i=u(this);for(t=t||[];this.pos<i;)t.push(this.readFloat());return t},readPackedDouble:function(t){var i=u(this);for(t=t||[];this.pos<i;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var i=u(this);for(t=t||[];this.pos<i;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var i=u(this);for(t=t||[];this.pos<i;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var i=u(this);for(t=t||[];this.pos<i;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var i=u(this);for(t=t||[];this.pos<i;)t.push(this.readSFixed64());return t},skip:function(t){var i=7&t;if(i===o.Varint)for(;127<this.buf[this.pos++];);else if(i===o.Bytes)this.pos=this.readVarint()+this.pos;else if(i===o.Fixed32)this.pos+=4;else{if(i!==o.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(t,i){this.writeVarint(t<<3|i)},realloc:function(t){for(var i=this.length||16;i<this.pos+t;)i*=2;if(i!==this.length){var e=new Uint8Array(i);e.set(this.buf),this.buf=e,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),M(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),M(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),M(this.buf,-1&t,this.pos),M(this.buf,Math.floor(t*h),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),M(this.buf,-1&t,this.pos),M(this.buf,Math.floor(t*h),this.pos+4),this.pos+=8},writeVarint:function(t){268435455<(t=+t||0)||t<0?function(t,i){var e,r;0<=t?(e=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(e=~(-t%4294967296))?e=e+1|0:r=r+1|(e=0));if(0x10000000000000000<=t||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),n=e,s=i,s.buf[s.pos++]=127&n|128,n>>>=7,s.buf[s.pos++]=127&n|128,n>>>=7,s.buf[s.pos++]=127&n|128,n>>>=7,s.buf[s.pos++]=127&n|128,n>>>=7,s.buf[s.pos]=127&n,function(t,i){var e=(7&t)<<4;if(i.buf[i.pos++]|=e|((t>>>=3)?128:0),!t)return;if(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),!t)return;i.buf[i.pos++]=127&t}(r,i);var n,s}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(127<t?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(127<t?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(127<t?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var i=this.pos;this.pos=function(t,i,e){for(var r,n,s=0;s<i.length;s++){if(55295<(r=i.charCodeAt(s))&&r<57344){if(!n){56319<r||s+1===i.length?(t[e++]=239,t[e++]=191,t[e++]=189):n=r;continue}if(r<56320){t[e++]=239,t[e++]=191,t[e++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(t[e++]=239,t[e++]=191,t[e++]=189,n=null);t[e++]=r<128?r:(t[e++]=r<2048?r>>6|192:(t[e++]=r<65536?r>>12|224:(t[e++]=r>>18|240,r>>12&63|128),r>>6&63|128),63&r|128)}return e}(this.buf,t,this.pos);var e=this.pos-i;128<=e&&c(i,e,this),this.pos=i-1,this.writeVarint(e),this.pos+=e},writeFloat:function(t){this.realloc(4),n(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),n(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var i=t.length;this.writeVarint(i),this.realloc(i);for(var e=0;e<i;e++)this.buf[this.pos++]=t[e]},writeRawMessage:function(t,i){this.pos++;var e=this.pos;t(i,this);var r=this.pos-e;128<=r&&c(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,i,e){this.writeTag(t,o.Bytes),this.writeRawMessage(i,e)},writePackedVarint:function(t,i){this.writeMessage(t,p,i)},writePackedSVarint:function(t,i){this.writeMessage(t,l,i)},writePackedBoolean:function(t,i){this.writeMessage(t,v,i)},writePackedFloat:function(t,i){this.writeMessage(t,d,i)},writePackedDouble:function(t,i){this.writeMessage(t,x,i)},writePackedFixed32:function(t,i){this.writeMessage(t,g,i)},writePackedSFixed32:function(t,i){this.writeMessage(t,b,i)},writePackedFixed64:function(t,i){this.writeMessage(t,m,i)},writePackedSFixed64:function(t,i){this.writeMessage(t,F,i)},writeBytesField:function(t,i){this.writeTag(t,o.Bytes),this.writeBytes(i)},writeFixed32Field:function(t,i){this.writeTag(t,o.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(t,i){this.writeTag(t,o.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(t,i){this.writeTag(t,o.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(t,i){this.writeTag(t,o.Fixed64),this.writeSFixed64(i)},writeVarintField:function(t,i){this.writeTag(t,o.Varint),this.writeVarint(i)},writeSVarintField:function(t,i){this.writeTag(t,o.Varint),this.writeSVarint(i)},writeStringField:function(t,i){this.writeTag(t,o.Bytes),this.writeString(i)},writeFloatField:function(t,i){this.writeTag(t,o.Fixed32),this.writeFloat(i)},writeDoubleField:function(t,i){this.writeTag(t,o.Fixed64),this.writeDouble(i)},writeBooleanField:function(t,i){this.writeVarintField(t,Boolean(i))}};var S=k;function k(t,i){this.x=t,this.y=i}k.prototype={clone:function(){return new k(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,i){return this.clone()._rotateAround(t,i)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var i=t.x-this.x,e=t.y-this.y;return i*i+e*e},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,i){return Math.atan2(this.x*i-this.y*t,this.x*t+this.y*i)},_matMult:function(t){var i=t[0]*this.x+t[1]*this.y,e=t[2]*this.x+t[3]*this.y;return this.x=i,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var i=Math.cos(t),e=Math.sin(t),r=i*this.x-e*this.y,n=e*this.x+i*this.y;return this.x=r,this.y=n,this},_rotateAround:function(t,i){var e=Math.cos(t),r=Math.sin(t),n=i.x+e*(this.x-i.x)-r*(this.y-i.y),s=i.y+r*(this.x-i.x)+e*(this.y-i.y);return this.x=n,this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},k.convert=function(t){return t instanceof k?t:Array.isArray(t)?new k(t[0],t[1]):t};var P=B;function B(t,i,e,r,n){this.properties={},this.extent=e,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=n,t.readFields(T,this,i)}function T(t,i,e){1==t?i.id=e.readVarint():2==t?function(t,i){var e=t.readVarint()+t.pos;for(;t.pos<e;){var r=i._keys[t.readVarint()],n=i._values[t.readVarint()];i.properties[r]=n}}(e,i):3==t?i.type=e.readVarint():4==t&&(i._geometry=e.pos)}function z(t){for(var i,e,r=0,n=0,s=t.length,o=s-1;n<s;o=n++)i=t[n],r+=((e=t[o]).x-i.x)*(i.y+e.y);return r}B.types=["Unknown","Point","LineString","Polygon"],B.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var i,e=t.readVarint()+t.pos,r=1,n=0,s=0,o=0,a=[];t.pos<e;){if(n<=0){var h=t.readVarint();r=7&h,n=h>>3}if(n--,1===r||2===r)s+=t.readSVarint(),o+=t.readSVarint(),1===r&&(i&&a.push(i),i=[]),i.push(new S(s,o));else{if(7!==r)throw new Error("unknown command "+r);i&&i.push(i[0].clone())}}return i&&a.push(i),a},B.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var i=t.readVarint()+t.pos,e=1,r=0,n=0,s=0,o=1/0,a=-1/0,h=1/0,u=-1/0;t.pos<i;){if(r<=0){var f=t.readVarint();e=7&f,r=f>>3}if(r--,1===e||2===e)(n+=t.readSVarint())<o&&(o=n),a<n&&(a=n),(s+=t.readSVarint())<h&&(h=s),u<s&&(u=s);else if(7!==e)throw new Error("unknown command "+e)}return[o,h,a,u]},B.prototype.toGeoJSON=function(t,i,e){var r,n,s=this.extent*Math.pow(2,e),o=this.extent*t,a=this.extent*i,h=this.loadGeometry(),u=B.types[this.type];function f(t){for(var i=0;i<t.length;i++){var e=t[i],r=180-360*(e.y+a)/s;t[i]=[360*(e.x+o)/s-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var c=[];for(r=0;r<h.length;r++)c[r]=h[r][0];f(h=c);break;case 2:for(r=0;r<h.length;r++)f(h[r]);break;case 3:for(h=function(t){var i=t.length;if(i<=1)return[t];for(var e,r,n=[],s=0;s<i;s++){var o=z(t[s]);0!==o&&(void 0===r&&(r=o<0),r===o<0?(e&&n.push(e),e=[t[s]]):e.push(t[s]))}e&&n.push(e);return n}(h),r=0;r<h.length;r++)for(n=0;n<h[r].length;n++)f(h[r][n])}1===h.length?h=h[0]:u="Multi"+u;var p={type:"Feature",geometry:{type:u,coordinates:h},properties:this.properties};return"id"in this&&(p.id=this.id),p};var L=A;function A(t,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(N,this,i),this.length=this._features.length}function N(t,i,e){15===t?i.version=e.readVarint():1===t?i.name=e.readString():5===t?i.extent=e.readVarint():2===t?i._features.push(e.pos):3===t?i._keys.push(e.readString()):4===t&&i._values.push(function(t){var i=null,e=t.readVarint()+t.pos;for(;t.pos<e;){var r=t.readVarint()>>3;i=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return i}(e))}function I(t,i,e){if(3===t){var r=new L(e,e.readVarint()+e.pos);r.length&&(i[r.name]=r)}}A.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var i=this._pbf.readVarint()+this._pbf.pos;return new P(this._pbf,i,this.extent,this._keys,this._values)};var C={VectorTile:function(t,i){this.layers=t.readFields(I,{},i)},VectorTileFeature:P,VectorTileLayer:L},D=C.VectorTile,E=C.VectorTileFeature,U=y.TaskManager.getInstance(),j=16,q=0;function O(t){for(var i,e,r=0,n=0,s=t.length,o=s-1;n<s;o=n++)i=t[n],r+=((e=t[o]).x-i.x)*(i.y+e.y);return r}function G(t,i,e,r,o){var n,s,a=t.extent*Math.pow(2,r),h=t.extent*i,u=t.extent*e,f=t.loadGeometry(),c=E.types[t.type],p=1/0,l=-p,d=p,y=-d;function w(t){for(var i=0;i<t.length;i++){var e=t[i],r=180-360*(e.y+u)/a,n=360*(e.x+h)/a-180,s=360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90;o&&(n<p&&(p=n),l<n&&(l=n),s<d&&(d=s),y<s&&(y=s)),t[i]=[n,s]}}switch(t.type){case 1:var x=[];for(n=0;n<f.length;n++)x[n]=f[n][0];w(f=x);break;case 2:for(n=0;n<f.length;n++)w(f[n]);break;case 3:for(f=function(t){var i=t.length;if(i<=1)return[t];for(var e,r,n=[],s=0;s<i;s++){var o=O(t[s]);0!==o&&(void 0===r&&(r=o<0),r===o<0?(e&&n.push(e),e=[t[s]]):e.push(t[s]))}return e&&n.push(e),n}(f),n=0;n<f.length;n++)for(s=0;s<f[n].length;s++)w(f[n][s])}1===f.length?f=f[0]:c="Multi"+c;var v={type:"Feature",geometry:{type:c,coordinates:f},properties:t.properties};return"id"in t&&(v.id=t.id),o&&(v.bbox=[p,d,l,y]),v}function R(r){U.create({init:function(){var t=new D(new s(r.data)),i=[];for(var e in t.layers)i.push(e);return{x:r.x,y:r.y,z:r.z,vt:t,layers:i,l:0,f:0,geojson:[]}},priority:4,exec:function(t){for(var i,e,r=t.vt,n=t.layers,s=t.l,o=t.f,a=t.geojson,h=t.x,u=t.y,f=t.z;s<n.length;){for(i=r.layers[n[s]];o<i.length;)if((e=G(i.feature(o++),h,u,f,!0)).id=++q,e.properties.layer=i.name,a.push(e),!(o%j))return t.f=o,this.CONTINUE;return t.l=++s,t.f=0,this.CONTINUE}return this.BREAK},onDone:function(t){r.ready(t.geojson)}}).start()}var W=function(e){function t(t){var i=e.call(this,y.JSUtils.extend({loader:t.loader||new w(t),margin:0,staticData:!0},t),R)||this;return i.c=null,i}return i(t,e),t.prototype.getCopyright=function(t){var i=this,e=i.url.match(/.*xyz+.*here\.com\/tiles\/[a-zA-Z]+[\.\d]*\//),r=i.c;t&&(null==r?e?((r=new y.Queue).add(t),i.c=r,i.getLoader().src[0].send({url:e+"copyright",responseType:"json",success:function(t){i.c=t,r.done(t)}})):t(i.c=[]):r instanceof y.Queue?r.add(t):t(r))},t}(t.providers.RemoteTileProvider),J={backgroundColor:"#555555",strokeWidthZoomScale:function(t){return 17<t?1:14<t?.5:.25},styleGroups:{earth:[{zIndex:1,type:"Polygon",fill:"#555555"}],water:[{zIndex:2,type:"Polygon",fill:"#353535"}],landuse:[{zIndex:3,type:"Polygon",fill:"#666666"}],roads:[{zIndex:4,type:"Line",stroke:"#ffffff",strokeWidth:4}],roadshighway:[{zIndex:5,type:"Line",stroke:"#ffffff",strokeWidth:6}],buildings:[{zIndex:7,type:"Polygon",fill:"#999999"}]},assign:function(t,i){var e=t.properties,r=e.kind,n=e.layer,s=t.geometry.type;if("water"!=n||"LineString"!=s&&"MultiLineString"!=s){if("roads"==n){if("rail"==r||"ferry"==r)return;if("highway"==r)return n+r}return n}}},Q=t.layers.TileLayer,Z=t.storage.Level2Storage,H=function(d){function t(t){var i,e=t.remote,r=e.url,n=e.min||2,s=e.max||16,o=e.tileSize,a=t.name||"",h=t.max||20,u=new w(e),f=[];o||(o=(o=r.match(/256|512|1024|2048|4096/))?Number(o[0]):512),i=Math.round(Math.log(o)/Math.log(2)-8);for(var c=new y.LRU(256/Math.pow(2,i)),p=new y.LRU(4*c.max),l=n;l<=s;l++)f.push({min:l,max:l==s?h:l,provider:new W({name:a+"-L"+l,url:r,level:l-i,loader:u,storage:new Z(l-i,c,p)})});return d.call(this,{name:t.name,providers:f,min:t.min||n,max:h,margin:0,style:t.style||J})||this}return i(t,d),t.prototype.getCopyright=function(t){this.getProvider(this.max).getCopyright(t)},t}(Q);return t.providers.MVTProvider=W,t.layers.MVTLayer=H,t});
